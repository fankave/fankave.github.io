angular.module("Forum",["ngRoute","ngSanitize","ng.deviceDetector","AuthModule","ChannelModule","TopicModule","PostModule","NetworkModule","MediaModule","SocialModule","UserInput","SmartStadiumModule"]).config(["$routeProvider","$locationProvider",function(e,o){e.when("/login",{templateUrl:"partials/facebookLogin.html",controller:"AuthController"}).when("/channel/:channelID",{templateUrl:"partials/login.html",controller:"ChannelController"}).when("/topic/:topicID",{templateUrl:"partials/topic.html",controller:"TopicController"}).when("/post/:postID",{templateUrl:"partials/post.html",controller:"PostController"}).when("/invalidTopic",{templateUrl:"partials/invalidTopic.html"}).otherwise({redirectTo:"/invalidTopic"}),window.history&&window.history.pushState&&HTML5_LOC&&o.html5Mode({enabled:!0})}]).filter("hashtags",["$filter","$sce",function(e,o){return function(t,n){if(!t)return t;var i=e("linky")(t,n),r="";angular.isDefined(n)&&(r=' target="'+n+'"');var a=/(^|\s)#(\w*[a-zA-Z_]+\w*)/gim;i=t.replace(a,'$1<a href="https://twitter.com/search?q=%23$2"'+r+">#$2</a>");var s=/(^|\s)\@(\w*[a-zA-Z_]+\w*)/gim;return i=i.replace(s,'$1<a href="https://twitter.com/$2"'+r+">@$2</a>"),o.trustAsHtml(i),i}}]),angular.module("Forum").directive("ngElementReady",[function(){return{priority:-1e3,restrict:"A",link:function(e,o,t){e.$eval(t.ngElementReady)}}}]),angular.module("Forum").directive("reportPageHeight",["URIHelper",function(e){return{link:function(o,t,n){function i(e){GEN_DEBUG&&console.log("Sending Height: ",e,parent);var o={type:"resize",contentHeight:e};parent.postMessage(o,"http://www.fankave.net")}e.embedded()&&(o.$watch(function(){o.__height=t.height(),console.log("Setting Height: ",o.__height)}),o.$watch("__height",function(e,o){console.log("Watching Height: ",e,o),i(e)}))}}}]),angular.module("ChannelModule",["NetworkModule","AuthModule"]).controller("ChannelController",["$scope","$window","$location","$sce","$routeParams","networkService","ChannelService","TopicService","URIHelper","AuthService","UserInfoService",function(e,o,t,n,i,r,a,s,l,c,d){function u(){console.log("Init all connections"),r.init(),r.send(a.getLiveGameTopic())}function m(){var e=a.getLiveTopicId();void 0!==e&&(ga("send","pageview","/topic/"+e),console.log("Sent Pageview from /channel/"+e),console.log("Got Topic id from Channel : /topic/"+e+p),p?t.url("/topic/"+e+"?"+p):t.url("/topic/"+e))}if(a.setChannel(i.channelID),-1!==window.location.href.indexOf("?")){var p=window.location.href.slice(window.location.href.indexOf("?")+1);console.log("urlQueryStr: ",p)}a.registerObserverCallback(m),l.embedded(),d.isUserLoggedIn()?(NETWORK_DEBUG&&console.log("User is logged in, checking for connection"),u()):l.isSmartStadiumUser()?c.loginWithEmail():l.isTechMUser()?(console.log("MI16 User Detected"),t.url("/login?MI16=true")):l.isMWCUser()?(GEN_DEBUG&&console.log("MWC User Detected"),t.url("/login?MWC=true")):l.isPeelUser()?c.loginWithPeel():c.loginAsGuest()}]),angular.module("AuthModule",["NetworkModule","TopicModule"]).controller("AuthController",["$scope","$routeParams","$http","AuthService","UserInfoService","TopicService","ReplyService","networkService","ForumDeviceInfo","ChannelService","URIHelper",function(e,o,t,n,i,r,a,s,l,c,d){function u(){e.showFacebookButton=!1}if(d.embedded()&&$("#fankave-page").height(700),-1!==window.location.href.indexOf("?")){var m=window.location.href.slice(window.location.href.indexOf("?")+1);GEN_DEBUG&&console.log("urlQueryStr: ",m),d.isTechMUser()&&(e.mUserType="MI16"),d.isMWCUser()&&(e.mUserType="MWC")}else e.facebookUser=!0;e.facebookUser?(!function(e,o,t){var n,i=e.getElementsByTagName(o)[0];e.getElementById(t)||(n=e.createElement(o),n.id=t,n.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(n,i))}(document,"script","facebook-jssdk"),ga("send","pageview","Facebook Landing")):ga("send","pageview","Tech MI16 Landing"),e.showFacebookButton=!0,e.loginToFacebook=function(){n.loginToFacebook(u)},e.techMLogin=function(o,t,i){i&&n.techMLogin(o,t,e.mUserType),e.submitted=!0},window.fbAsyncInit=function(){FB.init({appId:"210324962465861",xfbml:!0,version:"v2.4"}),FB.getLoginStatus(function(o){if("connected"===o.status){e.showFacebookButton=!1;var t=n.setRegistrationParams("facebook",-25200,o.authResponse);n.registerUser(t)}else"not_authorized"===o.status?(e.showFacebookButton=!1,e.loginToFacebook()):e.showFacebookButton=!0})},e.focusMWC=function(){$("#techLoginContainer").animate({top:"-150px"},100)},e.blurMWC=function(){$("#techLoginContainer").animate({top:""},100)}}]),angular.module("TopicModule",["NetworkModule","SplashModule","AuthModule","MediaModule","angularFileUpload","SocialModule"]).controller("TopicController",["$scope","$rootScope","$q","$sce","$window","$location","$sanitize","$timeout","$interval","$routeParams","networkService","TopicService","CommentService","UserInfoService","URIHelper","AuthService","SplashService","MUService","ForumStorage","FileUploader","SocialService","VideoService","ChannelService","UserAgentService",function(e,o,t,n,r,a,s,l,c,d,u,m,p,g,f,h,v,T,S,w,b,y,U,C){function E(){"livegame"===e.topicType&&(e.isPeelUser&&e.peelShowId?$("#topicSection").css("padding-top","54px"):e.isSmartStadiumUser?$("#topicSection").css("padding-top","54px"):e.isMI16User||$("#topicSection").css("padding-top","0px"))}function k(){if(void 0!==m.getTopic()){if(e.topicType=m.getTopicType(),m.isWatchingTopic()===!1&&(u.send(m.getFollowChannelRequest()),u.send(m.watchTopicRequest(d.topicID))),E(),"livegame"==e.topicType){console.log("Inside topic set :"+m.getTeamA()),e.isCricket=m.isGameCricket(),e.isCricket&&!e.$$phase&&e.$apply(),e.leftTeam=m.getTeamA(),e.rightTeam=m.getTeamB();var t=m.getScore();void 0!=t&&(e.leftTeamScore=t.points[0],e.rightTeamScore=t.points[1]),e.gameStatus=m.getGameStatus(),"live"==e.gameStatus&&(e.gamePeriod=m.getGamePeriod(),e.gameClock=m.getGameClock(),e.isCricket&&(e.offenseTeam=m.getOffense().team,e.offensePosition=m.getOffense().position)),"past"===e.gameStatus&&e.isCricket&&(e.gameSummary=m.getGameSummary()),e.gameScheduledTime=m.getGameTime(),e.allScoresTitle=m.getScoresTitle(),e.allScoresURL=m.getScoresLink();var n=$(".scoreCardContent"),i=$(".svg-content");n.css("background-color",e.leftTeam.pColor),i.css("fill",e.rightTeam.pColor)}e.topicTitle=m.getTitle();var r=m.getTopic();e.topicDescHtml=r.html,"media"==r.type&&(e.topicMediaUrl=r.mediaUrl,e.topicMediaAspectFeed=r.mediaAspectFull),e.createdAt=m.getTimeCreatedAt(),e.liked=m.getLiked();var a=m.getMetrics();e.likesCount=a.likes,e.commentsCount=a.comments,e.commentsCount&&0!==e.commentsCount||(e.loadingChat=!1),f.tabEntry()||("video"===f.getActiveTab()&&o.$broadcast("videoActive"),"social"===f.getActiveTab()&&o.$broadcast("socialActive"))}}function A(){var o=p.comments();if(void 0!=o&&(o.length>0||N===!0)){N=!1;var t=o.length;for(e.commentsArray=[],i=0;i<t;i++){var n={};n=o[i],n.postAuthorName=o[i].author.name,n.postAuthorPhoto=o[i].author.photo,n.isMyComment=g.isCurrentUser(o[i].author.id),n.likeCount=o[i].metrics.likes,n.replyCount=o[i].metrics.replies,n.postTimestamp=o[i].createdAt,"media"===n.type&&(n.mediaUrl=o[i].mediaUrl,n.mediaAspectFeed=o[i].mediaAspectFeed,n.mediaAspectFull=o[i].mediaAspectFull,n.mediaAspectRatio=o[i].mediaAspectRatio,n.mediaOrientation=o[i].mediaOrientation,n.mediaThumbUrl=o[i].mediaThumbUrl),n.isLiked=o[i].signal.like,"embed"===n.type&&(n.shared=!0,n.embed=o[i].embed,n.embed.embedCreatedAt=o[i].embedCreatedAt,n.embed.embedCreatedAtFull=o[i].embedCreatedAtFull,n.embedType=o[i].embedType,("media"===n.embedType||"link"===n.embedType)&&(n.mediaUrl=o[i].embedMedia.mediaUrl,n.mediaThumbUrl=o[i].embedMedia.mediaThumbUrl,n.mediaAspectFeed=o[i].embedMedia.mediaAspectFeed,n.mediaAspectFull=o[i].embedMedia.mediaAspectFull,n.mediaAspectRatio=o[i].embedMedia.mediaAspectRatio,n.mediaOrientation=o[i].embedMedia.mediaOrientation),"Twitter"===n.providerName?n.embed.embedLogo="img/twitterLogo@2x.png":n.embed.embedLogo=o[i].embed.provider.logo,"link"===o[i].embed.type&&o[i].embed.playable===!0&&(n.embedHtml=o[i].embedHtml)),e.commentsArray.push(n),i===t-1&&NETWORK_DEBUG&&console.log("Comments Array: ",e.commentsArray)}}}function I(){console.log("LOADING REST OF COMMENTS..."),p.loadedComments()||(u.send(p.getCommentsRequest(d.topicID)),p.setLoadedComments(!0),e.loadedAllComments=!0)}function M(){u.send(m.getTopicRequest(d.topicID)),u.send(p.getCommentsRequest(d.topicID))}function R(){var t=C.getDeviceInfo();console.log("!! NEW DEVICE INFO: ",t),"video"===f.getActiveTab()?o.leftTab="video":"social"===f.getActiveTab()?o.leftTab="social":o.leftTab="chat",k(),A(),e.pageClass="page-topic",e.showNewCommentsIndicator=!1,e.topicID=d.topicID,M(),e.mobileBrowser!==!0||f.embedded()||(document.getElementById("topicSection").style.paddingBottom="42px")}function D(e,o,t){var n;return function(){var i=this,r=arguments,a=function(){n=null,t||e.apply(i,r)},s=t&&!n;clearTimeout(n),n=setTimeout(a,o),s&&e.apply(i,r)}}var O=window.time,N=!1;C.isMobileUser()?(e.mobileBrowser=!0,e.mobileUserAgent=C.getMobileUserAgent(),console.log("MOBILE USER AGENT: ",e.mobileUserAgent)):e.mobileBrowser=!1,f.embedded(),g.isUserLoggedIn()?(NETWORK_DEBUG&&console.log("User is logged in, checking for connection"),u.isSocketConnected()||u.init(),R()):f.isSmartStadiumUser()?(console.log("SS User? ",e.isSmartStadiumUser),h.loginWithEmail(R)):f.isTechMUser()?(console.log("Topic Found MI16"),a.url("/login?MI16=true")):f.isMWCUser()?(console.log("Topic Found MWC"),a.url("/login?MWC=true")):f.isPeelUser()?h.loginWithPeel(R):h.loginAsGuest(R),e.commentsArray||(e.loadingChat=!0),void 0==U.getChannel()&&void 0==m.getChannel()&&(ga("send","pageview","/topic/"+d.topicID),console.log("Sent Pageview from /topic/"+d.topicID)),m.setTopicId(d.topicID),e.topicType="livegame",e.innerButtonTapped=!1,g.isSmartStadiumUser()?(e.isSmartStadiumUser=!0,console.log("SS USER HASNT VISITED"),e.hideSSSplash=!1,S.setToLocalStorage("hasUserVisited",!0),l(function(){e.continueToExperience("smartS")},5e3)):g.isMI16User()?e.isMI16User=!0:g.isMWCUser()?e.isMWCUser=!0:g.isPeelUser()?(e.isPeelUser=!0,f.getPeelShowId()?e.peelShowId=!0:e.peelShowId=!1):(e.isPeelUser=!1,e.hidePeelSplash=!0,e.hideSSSplash=!0),e.continueToExperience=function(o){console.log("CONTINUE XP CLICKED"),"peel"===o?(v.setPeelSplash(!0),e.hidePeelSplash=!0):"smartS"===o&&(v.setSSSplash(!0),e.hideSSSplash=!0)},e.activeTab="chat",e.switchTabs=function(o){var t=window.time-O;ga("send","event","Tabs","ActiveTab",e.activeTab),ga("send","event","Tabs","TabSessionLength",e.activeTab,t),O=window.time,"chat"===o&&(e.activeTab="chat",$(document).scrollTop(0),u.isSocketConnected()||M()),"video"===o&&(e.activeTab="video",$(document).scrollTop(0)),"social"===o&&(e.activeTab="social",$(document).scrollTop(0)),console.log("Active Tab: ",e.activeTab)},e.loadRemainingCommentsTimeout=function(){l(function(){p.loadedComments()||(console.log("LOADING REST OF COMMENTS..."),u.send(p.getCommentsRequest(d.topicID)),e.loadedAllComments=!0,p.setLoadedComments(!0))},7e3)},e.hideLoading=function(){console.log("HIDING LOAD"),e.loadingChat=!1,e.loadingSocial=!1};e.viewPost=function(e,o){if(-1!==window.location.href.indexOf("?"))var t=window.location.href.slice(window.location.href.indexOf("?"));$(e.target).is("a")||(m.currentTimer()&&c.cancel(m.currentTimer(!1)),y.resetVideoOffset(),b.resetSocialOffset(),void 0!==t?(console.log("View Qry: ",t),a.url("/post/"+o+t)):a.url("/post/"+o))},e.peelClose=function(){ga("send","event","Peel","click","BackToPeelHome"),console.log("peelClose()"),window.location="peel://home"},e.peelWatchOnTV=function(){ga("send","event","Peel","click","PeelWatchOnTV"),console.log("peelWatchOnTV()");var e=f.getPeelShowId();console.log("Peel show on TV uri :  peel://tunein/"+e),void 0!=e?window.location="peel://tunein/"+e:window.location="peel://home"},e.showNewCommentsIndicator=!1,e.newCommentsIndicatorTapped=function(){console.log("newCommentsIndicatorTapped"),e.showNewCommentsIndicator=!1,A(),$(document).scrollTop(0)},e.imageClick=function(e){event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation(),$.magnificPopup.open({items:{type:"image",src:e},type:"inline",callbacks:{open:function(){console.log("popup opened"),$("body").bind("touchmove",function(e){e.preventDefault()})},close:function(){console.log("popup closed"),$("body").unbind("touchmove")}}})},e.moreButtonTapped=function(){e.innerButtonTapped=!0},e.updateLikeTopic=function(){console.log("TopicController update like Topic"),1==m.getLiked()?u.send(m.getUnlikeTopicRequest()):u.send(m.getLikeTopicRequest())},e.commentOnTopic=function(){document.getElementById("commentField").focus()},e.updateLikeComment=function(e,o){e.justLiked?e.justLiked=!1:(e.justLiked=!0,GEN_DEBUG&&console.log("JUST LIKED!")),GEN_DEBUG&&console.log("TopicController updateLike ("+o+")"),p.isCommentLiked(o)?u.send(p.getUnlikeCommentRequest(o)):u.send(p.getLikeCommentRequest(o))},e.deleteComment=function(o){console.log("deleteComment("+o+")"),1===e.commentsArray.length&&(console.log("Deleting Final Comment"),N=!0),e.innerButtonTapped=!0,u.send(p.deleteCommentRequest(o))},e.reportCommentAsSpam=function(o){console.log("reportCommentAsSpam("+o+")"),e.innerButtonTapped=!0,u.send(p.flagCommentRequest(o))},e.goToRepliesWithKeyboardTriggered=function(e){if(-1!==window.location.href.indexOf("?"))var o=window.location.href.slice(window.location.href.indexOf("?"));m.directComment=!0,y.resetVideoOffset(),b.resetSocialOffset(),void 0!==o?a.url("/post/"+e+o):a.url("/post/"+e)},e.secureLink=function(e,o){return g.isGuestUser()?"":e+o};var F=function(){if(void 0==e.commentsArray)console.log("Notify: Undefined Array, Update"),A();else{var o=p.comments(),t=o.length,n=p.getNumPinComments();e.commentsArray.length<t?g.isCurrentUser(o[n].author.id)?(console.log("Notify: Author, Update"),A()):(console.log("Notify: New Comments"),e.showNewCommentsIndicator=!0):(console.log("Notify: Update"),A())}};m.registerObserverCallback(k),p.registerObserverCallback(F),p.registerObserverCallback(function(){A(!0)},!0),e.trustSrc=function(e){return n.trustAsResourceUrl(e)},r.addEventListener("beforeunload",function(){u.closeSocket(),console.log("Before Unload: Close Socket")}),e.xLinkActivated=!1;var P=U.getChannel();m.setChannel(P);var B,x,L,G,W,_,K,q,V=!1;e.setDocVars=function(){V||(B=$("#inputControls"),x=$(".tabContainer"),L=B.offset().top,G=x.height(),W=B.height(),_=document.documentElement.clientHeight,K=$(document).height(),V=!0,q=e.isSmartStadiumUser?54:e.isPeelUser&&e.peelShowId?54:e.isMWCUser?$("#MWCBanner").height():0)};var H=!1,j=function(){console.log("Tabs Top: ",L),e.showNewCommentsIndicator&&(e.showNewCommentsIndicator=!1),$(document).scrollTop()>L-q&&K-_>L+W-G?(B.addClass("fixTabsPeel"),B.css("top",q),x.addClass("fixTabContainer"),$("#commentsContainer").css("padding-top",$("#inputControls").height()),H=!0):H&&(B.removeClass("fixTabsPeel"),B.css("top",""),x.removeClass("fixTabContainer"),$("#commentsContainer").css("padding-top",""),H=!1)},z=D(function(){if("chat"===e.activeTab){var o=document.documentElement.clientHeight||window.innerHeight,t=$(document).height()-o-150;$(document).scrollTop()>t&&t>500&&I()}},100);$(document).off("scroll"),$(document).on("scroll",j),$(document).on("scroll",z)}]),angular.module("SocialModule",["NetworkModule","ChannelModule","TopicModule"]).controller("SocialController",["$scope","$sce","$window","$location","$routeParams","$q","$interval","$http","SocialService","VideoService","networkService","ChannelService","TopicService","DateUtilityService","CommentService","URIHelper","UserAgentService",function(e,o,t,n,i,r,a,s,l,c,d,u,m,p,g,f,h){function v(){window.twttr=function(e,o,t){var n,i=e.getElementsByTagName(o)[0],r=window.twttr||{};return e.getElementById(t)?r:(n=e.createElement(o),n.id=t,n.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i),r._e=[],r.ready=function(e){r._e.push(e)},r)}(document,"script","twitter-wjs")}function T(e){var o;"social"===e&&(o=document.getElementById("socialJewel")),"video"===e&&(o=document.getElementById("videoJewel")),o.classList.remove("pulse")}function S(e,o){return e.postAuthorName=o.embedAuthor.name,e.postAuthorAlias=o.embedAuthor.alias,e.postAuthorPhoto=o.embedAuthor.photo,e.tweetId=o.tweet.id,e.postTimestamp=o.createdAt,e.providerName=o.embedProvider.name,e.html=o.embedText,e.retweetCount=o.tweet.metrics.retweetCount,e.likeCount=o.tweet.metrics.likeCount,e.replyCount=o.tweet.metrics.replyCount,e.embed=o.embed,e.embed.embedCreatedAt=o.embedCreatedAt,"Twitter"===e.providerName?(e.providerLogo="img/twitterLogo@2x.png",e.embed.provider.logo="img/twitterLogo@2x.png"):(e.providerLogo=o.embedProvider.logo,e.embed.provider.logo=o.embedProvider.logo),e.embedType=o.embedType,e.embedUrl=o.embedUrl,"link"===o.embedType&&o.embedPlayable===!0&&(e.embedHtml=o.embedHtml,e.embedPlayable=!0),("media"===o.embedType||"link"===o.embedType)&&(e.mediaType=o.embedMedia.mediaType,e.mediaUrl=o.embedMedia.mediaUrl,e.mediaThumbUrl=o.embedMedia.mediaThumbUrl,e.mediaAspectRatio=o.embedMedia.mediaAspectRatio,e.mediaAspectFeed=o.embedMedia.mediaAspectFeed,e.mediaAspectFull=o.embedMedia.mediaAspectFull,e.mediaOrientation=o.embedMedia.mediaOrientation),e}function w(e){var o,t,n;"social"===e?(o=l.socialArray(),E.socialArray=E.socialArray||[],t=E.socialArray.length,n=E.socialArray):(o=c.videoArray(),E.videoArray=E.videoArray||[],t=E.videoArray.length,n=E.videoArray);var i=o.length;if(o&&i>0){for(var r=0;i>r;r++){for(var a=o[r],s=!1,d=0;t>d;d++)a.id===n[d].id&&(s=!0);if(!s){var u=S(a,o[r]);"social"===e?E.socialArray.push(u):E.videoArray.push(u)}}NETWORK_DEBUG&&("social"===e?console.log("Social Array: ",E.socialArray):console.log("Video Array: ",E.videoArray))}}function b(e){if("social"===e){if(!E.socialArray)return;for(var o=0;o<E.socialArray.length;o++)E.socialArray[o].postTimestamp=p.getTimeSince(E.socialArray[o].createdAtFull)}else{if(!E.videoArray)return;for(var o=0;o<E.videoArray.length;o++)E.videoArray[o].postTimestamp=p.getTimeSince(E.videoArray[o].createdAtFull)}}function y(e,o,t){var n;return function(){var i=this,r=arguments,a=function(){n=null,t||e.apply(i,r)},s=t&&!n;clearTimeout(n),n=setTimeout(a,o),s&&e.apply(i,r)}}function U(){GEN_DEBUG&&console.log("Scroll Up to Top of Frame");var e={type:"scroll"};parent.postMessage(e,"http://www.fankave.net")}function C(e){var o=$("body");o.stop().animate({scrollTop:0},e.toString(),"swing"),E.preventLoad&&(E.preventLoad=!1)}console.log("Social Control");var E=this;this.initFeed=function(o){"social"===o?(E.newSocialAvailable&&(E.newSocialAvailable=!1),T("social"),E.socialArray?w("social"):(e.$parent.loadingSocial=!0,E.loadContent("social")),b("social"),e.$parent.switchTabs("social"),window.twttr||v()):(E.newVideoAvailable&&(E.newVideoAvailable=!1),T("video"),E.videoArray?w("video"):(e.$parent.loadingSocial=!0,E.loadContent("video")),b("video"),e.$parent.switchTabs("video"),window.twttr||v())},e.$on("videoActive",function(o,t){console.log("Video Broadcast Received"),e.$parent.activeTab="video",f.tabEntered(),E.initFeed("video")}),e.$on("socialActive",function(o,t){console.log("Social Broadcast Received"),e.$parent.activeTab="social",f.tabEntered(),E.initFeed("social")}),this.loadContent=function(e,o){var t=u.getChannel()||m.getChannelId();return"social"===e?(console.log("LOADING SOCIAL: ",t),d.send(l.getSocialDataRequest(t,o)),!0):(console.log("LOADING VIDEO: ",t),d.send(c.getVideoDataRequest(t,o)),!0)};l.registerObserverCallback(function(){w("social")}),c.registerObserverCallback(function(){w("video")});var k=document.documentElement.clientHeight||window.innerHeight,A=y(function(){var o=$(document).height()-k-150;$(document).scrollTop()>o&&("social"!==e.activeTab||E.preventLoad?"video"!==e.activeTab||E.preventLoad||E.loadContent("video"):E.loadContent("social"))},100);$(document).on("scroll",A),this.retweetPost=function(e){s({method:"GET",url:"https://twitter.com/intent/retweet?tweet_id="+e,headers:{"Access-Control-Allow-Origin":"*"}})},this.shareTweetToChat=function(o,t){E.embedShareContent=o,E.showShareDialog=!0;var n=$("#"+t).offset().top+"px";if(console.log("Embed Object: ",o,n),f.embedded()&&setTimeout(function(){$("#sharePreviewContainer").css({top:n})},0),e.$parent.isPeelUser&&e.$parent.peelShowId){var i=document.documentElement.clientHeight-54;console.log("fullClient Height: ",i),setTimeout(function(){$("#sharePreviewContainer").css({top:"54px"}).height(i)},25)}setTimeout(function(){$("#shareEmbedComment").focus()},0)},this.submitSharedPost=function(o,t){var n=e.$parent.topicID;console.log("topicID From Parent: ",n),d.send(g.postCommentRequestForShare(n,o,t)),E.showShareDialog=!1,e.$parent.switchTabs("chat"),f.embedded()&&U()},console.log("WAY BEFOREEEE"),window.FB||!function(e,o,t){console.log("loading FB SDK...");var n,i=e.getElementsByTagName(o)[0];e.getElementById(t)||(n=e.createElement(o),n.id=t,n.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(n,i))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){console.log("BEFOREEEE"),FB.init({appId:"210324962465861",xfbml:!0,version:"v2.4"}),console.log("AFTERRRRR")},this.shareToFacebook=function(e,o){FB.ui({method:"share",href:o},function(e){console.log("FB Response Post-Share: ",e)})},this.exitShare=function(){E.showShareDialog=!1},this.highlightPost=function(){$("#postShareContent").css("color","rgb(22,189,231)")},this.unhighlightPost=function(){$("#postShareContent").css("color","rgb(211,214,215)")},this.showNewSocial=function(){E.newSocialAvailable=!1,w("social");var e=$("body");e.stop().animate({scrollTop:0},"500","swing")},this.showNewVideo=function(){E.newVideoAvailable=!1,w("video");var e=$("body");e.stop().animate({scrollTop:0},"500","swing")},this.reportSocialInteraction=function(e,o,t){console.log("Social Button Clicked: ",e,o,t)},this.filterContent=function(e,o){"social"===e?"expert"===o?(E.preventLoad=!0,C(500),E.socialFilter=!0):E.socialFilter=!1:"video"===e&&("expert"===o?(E.preventLoad=!0,C(500),E.videoFilter=!0):E.videoFilter=!1)}}]),angular.module("UserInput",["NetworkModule","TopicModule","MediaModule","angularFileUpload"]).controller("UserInputController",["$scope","$window","$timeout","$routeParams","networkService","TopicService","CommentService","ReplyService","UserInfoService","FileUploader","MUService","UserAgentService",function(e,o,t,n,i,r,a,s,l,c,d,u){function m(o){var t=o.target.files[0];if(console.log("F:",t),!t.type.match("image.*"))var n="img/videoPrevIcon@2x.png";var i=new FileReader;i.onload=function(o){return function(o){var t=document.createElement("span");t.innerHTML=['<img class="thumb" src="',n||o.target.result,'"/>'].join(""),e.mobileBrowser!==!0||h?h||document.getElementById("preview").insertBefore(t,null):document.getElementById("mobilePreview").insertBefore(t,null)}}(t),i.readAsDataURL(t)}var p;p=DEV_BUILD===!0?"https://dev.fankave.com:8080":"https://mus.fankave.com";var g="/v1.0/media/upload",f=(this.uploader=new c({url:p+g,autoUpload:!1,removeAfterUpload:!0,queueLimit:1}),this);this.isHTML5=this.uploader.isHTML5,this.mediaType,this.uploader.filters.push({name:"customFilter",fn:function(e,o){var t=e.type;return-1!=t.indexOf("image")?(f.mediaType="image",this.queue.length<1&&e.size<5242880):-1!=t.indexOf("video")?(f.mediaType="video",this.queue.length<1&&e.size<268435456):this.queue.length<10}});var h;document.getElementById("fileUpload").addEventListener("change",m,!1),this.removeMedia=function(){f.uploader.clearQueue();var e=$("#fileUpload");e.wrap("<form>").closest("form").get(0).reset(),e.unwrap(),h=!1,f.unhighlightPost()},this.fileMaxExceeded=!1,this.uploader.onWhenAddingFileFailed=function(e,o,n){h=!0,console.info("onWhenAddingFileFailed",e,o,n),f.isHTML5?f.uploader.queue.length<1&&(f.fileMaxExceeded=!0,f.removeMedia(),t(function(){f.fileMaxExceeded=!1},5e3)):(console.log("Browser Doesn't Support HTML5"),f.HTML5warning=!0)},this.uploader.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e),f.highlightPost(),$("#commentField").focus()},this.uploader.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},this.uploader.onBeforeUploadItem=function(e){var o=l.getUserCredentials();e.headers={"X-UserId":o.userId,"X-SessionId":o.sessionId,"X-AccessToken":o.accessToken},e.formData=[{type:e._file.type},{size:e._file.size},{file:e._file}],console.info("onBeforeUploadItem",e)},this.uploader.onProgressItem=function(e,o){console.info("onProgressItem",e,o)},this.uploader.onProgressAll=function(e){console.info("onProgressAll",e)},this.uploader.onSuccessItem=function(e,o,t,n){console.info("onSuccessItem",e,o,t,n),i.send(d.postMediaRequest(o))},this.uploader.onErrorItem=function(e,o,t,n){console.info("onErrorItem",e,o,t,n)},this.uploader.onCancelItem=function(e,o,t,n){console.info("onCancelItem",e,o,t,n)},this.uploader.onCompleteItem=function(e,o,t,n){console.info("onCompleteItem",e,o,t,n)},this.uploader.onCompleteAll=function(){console.info("onCompleteAll"),f.uploader.clearQueue(),d.resetCommentParams()},console.info("uploader",this.uploader),this.postComment=function(o,t){f.uploader.queue.length>0&&t?d.setCommentParams(e.topicID,o,!0):f.uploader.queue.length>0&&!t?d.setCommentParams(e.topicId,o,!1,e.postID):o&&""!==o&&t?i.send(a.postCommentRequest(e.topicID,o)):o&&""!==o&&!t&&i.send(s.getPostReplyRequest(e.topicId,e.postID,o)),f.uploader.uploadAll(),e.commentText="",$("#commentField").blur(),$("#postCommentButton").css("color","rgb(211,214,215)"),t?$(document).scrollTop(0):window.scrollTo(0,document.body.scrollHeight)},this.highlightPost=function(){console.log("Styling post"),$("#postCommentButton").css("color","rgb(22,189,231)")},this.unhighlightPost=function(){console.log("Styling post"),f.uploader.queue.length<1&&$("#postCommentButton").css("color","rgb(211,214,215)")},this.fixIOSFocus=function(e){function o(){var e=255;0===window.scrollY?$(document).scrollTop(1):$(document).scrollTop(window.scrollY),t.style.bottom=parseFloat(t.style.bottom)+e-42+"px",t.style.height=t.clientHeight+52+"px"}if("iOS"===u.getMobileUserAgent()){var t=document.getElementById("mobileUserInput"),n=document.getElementById("attachMediaIcon"),i=document.getElementById("postCommentButton"),r=document.getElementById("commentField");i.addEventListener("touchstart",function(){GEN_DEBUG&&console.log("Post touchstart")}),n.addEventListener("touchstart",function(){$("#fileUpload").trigger("click"),GEN_DEBUG&&console.log("Media touchstart")}),r.addEventListener("touchstart",function(){function e(){setTimeout(function(){console.log("Blur"),t.style.position="",t.style.bottom="",t.style.height=""},20)}var n=parseFloat(window.getComputedStyle(t).bottom);t.style.position="absolute",t.style.bottom=document.body.clientHeight-(window.scrollY+window.innerHeight)+n+"px",r.addEventListener("focus",o),r.addEventListener("blur",e)})}},this.report=function(e){console.log(e)}}]),angular.module("Forum").factory("UserAgentService",["ForumStorage","UserInfoService","deviceDetector",function(e,o,t){function n(){var e;return i()&&(/iPad|iPhone|iPod/i.test(navigator.userAgent)&&!window.MSStream?e="iOS":/Android/i.test(navigator.userAgent)?e="android":/IEMobile/i.test(navigator.userAgent)&&(e="windows")),f=e,e}function i(){var e=!1;return function(o){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(o)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(o.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function r(e){return f===e?!0:!1}function a(){var e,o,n=t.raw,i=t.os,r=t.browser,a=t.device;if("mac"===i&&("chrome"===r?(e=s(n.userAgent),o=c(n.userAgent)):"safari"===r?(e=s(n.userAgent),o=u(n.userAgent)):"firefox"===r&&(e=l(n.userAgent),o=d(n.userAgent))),"windows"===i)for(var f in n.os_version)n.os_version.hasOwnProperty(f)&&n.os_version[f]===!0&&(e=f);"ios"===i&&(e=m(n.userAgent),"safari"===r&&(o=g(n.userAgent))),"android"===i&&(e=p(n.userAgent),"chrome"===r&&(o=c(n.userAgent)));var h={os:i,os_version:e,browser:r,browser_version:o};return"unknown"!==a&&(h.device=a),h}function s(e){return-1!==e.indexOf("Mac OS X")?(e=e.slice(e.indexOf("Mac OS X")+9),e.slice(0,e.indexOf(")"))):null}function l(e){return-1!==e.indexOf("Mac OS X")?(e=e.slice(e.indexOf("Mac OS X")+9),e.slice(0,e.indexOf(";"))):null}function c(e){return-1!==e.indexOf("Chrome/")?(e=e.slice(e.indexOf("Chrome/")+7),e.slice(0,e.indexOf(" "))):null}function d(e){return-1!==e.indexOf("Firefox/")?e=e.slice(e.indexOf("Firefox/")+8):null}function u(e){return-1!==e.indexOf("Version/")?(e=e.slice(e.indexOf("Version/")+8),e.slice(0,e.indexOf(" "))):null}function m(e){return-1!==e.indexOf("CPU iPhone OS")?(e=e.slice(e.indexOf("CPU iPhone OS")+14),e.slice(0,e.indexOf(" "))):null}function p(e){return-1!==e.indexOf("Linux; Android")?(e=e.slice(e.indexOf("Linux; Android")+15),e.slice(0,e.indexOf(";"))):null}function g(e){return-1!==e.indexOf("Version/")?(e=e.slice(e.indexOf("Version/")+8),e.slice(0,e.indexOf("/"))):null}var f;return{getMobileUserAgent:n,isMobileUser:i,isUserAgent:r,getDeviceInfo:a}}]),angular.module("NetworkModule",["ngWebSocket"]).factory("networkService",["$websocket","$route","DataService","UserInfoService",function(e,o,t,n){function i(){function o(){var e=n.getUserCredentials(),o=WEBSOCKET_BASE_URI+"userId="+e.userId+"&sessionId="+e.sessionId+"&accessToken="+e.accessToken+"/";return NETWORK_DEBUG&&console.log("socketUri: "+o),o}r&&r.close(),r=e(o()),t.setWatchTopic(!1),r.onOpen(function(){NETWORK_DEBUG&&console.log("Websocket Connected: ",r.readyState,r.OPEN)}),r.onClose(function(e){r=void 0,NETWORK_DEBUG&&console.log("Websocket Closed: ",e.data)}),r.onMessage(function(e){NETWORK_DEBUG&&console.log("Websocket Message Recieved:  ",e.data,r.OPEN);var o=JSON.parse(e.data),n=o.rid;void 0!==n&&("channel"===n&&(NETWORK_DEBUG&&console.log("Processing Channel"),t.setChannel(o)),"topic"===n||"score"===n?(NETWORK_DEBUG&&console.log("Processing Topic"),t.setTopic(o)):"comment"===n?(NETWORK_DEBUG&&console.log("Processing Comments"),t.setComments(o)):"reply"===n?(NETWORK_DEBUG&&console.log("Processing Reply"),t.setReplies(o)):"social"===n||"social_auto"===n?(NETWORK_DEBUG&&console.log("Processing Social"),
t.setSocial(o)):("video"===n||"video_auto"===n)&&(NETWORK_DEBUG&&console.log("Processing Video"),t.setVideo(o)))}),r.onError(function(e){NETWORK_DEBUG&&console.log("Websocket OnError: ",e)})}var r;return disconnectSocket=function(){NETWORK_DEBUG&&console.log("Disconnect Callback triggered"),void 0!==r&&(r.close(),r=void 0)},reconnectSocket=function(){NETWORK_DEBUG&&console.log("Reconnect Callback triggered"),o.reload()},{isSocketConnected:function(){return NETWORK_DEBUG&&(r?NETWORK_DEBUG&&console.log("WS Status: ",r.readyState," WS.OPEN: ",r.OPEN):NETWORK_DEBUG&&console.log("WS is null")),r&&1===r.readyState?!0:!1},send:function(e){r||i(),r.send(JSON.stringify(e))},closeSocket:function(){r&&r.close()},init:i}}]),angular.module("NetworkModule").factory("ForumStorage",function(){function e(e,o){void 0!=localStorage&&n&&localStorage.setItem(e,o)}function o(e){return void 0!=localStorage&&n?localStorage.getItem(e):void 0}function t(){void 0!=localStorage&&n&&localStorage.clear()}var n=!1;return void 0!=typeof Storage?(console.log("Local storage available :"+typeof Storage),n=!0):console.log("Sorry! No Storage support on this browser.."),{getFromLocalStorage:o,setToLocalStorage:e,clearStorage:t}}),angular.module("NetworkModule").factory("ForumDeviceInfo",["ForumStorage",function(e){function o(e){var o=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+o.substr(0,4)+"-"+o.substr(4,4):o}function t(){console.log("GEnerating UUID");var e=o()+o(!0)+o(!0)+o();return console.log(" UUID :"+e),e}return{getDeviceId:function(){var o=e.getFromLocalStorage("forumUUID");return(void 0==o||o.length<15)&&(o=t(),e.setToLocalStorage("forumUUID",o)),console.log("generated ID : "+o),o}}}]),angular.module("NetworkModule").factory("URIHelper",["ForumStorage","$rootScope",function(e,o){function t(){for(var e,o=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<t.length;n++)e=t[n].split("="),o.push(e[0]),o[e[0]]=e[1];return o}var n,i,r,a,s,l,c,d;return{isPeelUser:function(){var o=t();if(o.peel){i=o.userId,n=o.userName,r=o.showId;e.getFromLocalStorage("forumUserType");return e.setToLocalStorage("forumPeelUserId",i),e.setToLocalStorage("forumPeelShowId",r),!0}return!1},isSmartStadiumUser:function(){var o=t();return o.smartStadium?(s=o.userId,a=o.userName,e.setToLocalStorage("forumSmartStadiumUserId",s),!0):!1},isTechMUser:function(){var o=t();return o.MI16?(l=!0,e.setToLocalStorage("techMIUser",!0),!0):l?!0:!1},isMWCUser:function(){console.log("Checking For MWC");var o=t();return o.MWC?(console.log("MWC FOUND 1"),c=!0,e.setToLocalStorage("MWCUser",!0),!0):c?(console.log("MWC FOUND 2"),!0):!1},getPeelUserId:function(){return i},getPeelUserName:function(){return n},getPeelShowId:function(){return r},getPeelParams:function(){return window.location.search.substring(1)},getSSUserId:function(){return s},getSSUserName:function(){return a},getActiveTab:function(){var e=t();if(e.tab){if("video"===e.tab)return"video";if("social"===e.tab)return"social"}},isSuperBowl:function(){var e=t();return e.superbowl?!0:!1},tabEntered:function(){d=!0},tabEntry:function(){return d},extractOffset:function(e){var o=e.slice(e.indexOf("offset")),t=o.split("=");return t[1]},embedded:function(){var e=t();return e.embed?(console.log("Embed found in URL"),o.embed=!0,!0):o.embed?(console.log("Embed found on rootScope"),!0):!1}}}]),angular.module("ChannelModule").factory("ChannelService",["DateUtilityService","Bant","FDSUtility",function(e,o,t){function n(e){void 0!=e.data&&(s=e.data.id,console.log("_liveTopicId : "+s),c())}function i(e){var o=e||a,t="/v1.0/channel/topic/show/"+o+"?type=livegame";("404"==o||"5066"==o)&&(t="/v1.0/channel/topic/show/"+o);var n={rid:"channel",timestamp:(new Date).getTime(),method:"GET",uri:t};return console.log("Ch.getLiveGameTopic: ",n),n}function r(e){for(var o=l.length;o>0;)o=l.length,l.pop();l.push(e)}var a,s,l=[],c=function(){angular.forEach(l,function(e){e()})};return{setTopicData:n,getLiveTopicId:function(){return s},getLiveGameTopic:i,setChannel:function(e){a=e},getChannel:function(){return a},registerObserverCallback:r}}]),angular.module("TopicModule").directive("secureClick",["$location","$window","UserInfoService",function(e,o,t){return{restrict:"A",link:function(o,n,i){var r=n[0];$(r).on("click",function(n){n.preventDefault(),t.isGuestUser()?(e.url("/login"),o.$apply()):o.$eval(i.secureClick)})}}}]),angular.module("TopicModule").directive("secureFocus",["$location","$window","UserInfoService",function(e,o,t){return{restrict:"A",link:function(o,n,i){var r=n[0];$(r).on("focus",function(n){n.preventDefault(),t.isGuestUser()?(e.url("/login"),o.$apply()):o.$eval(i.secureFocus)})}}}]),angular.module("TopicModule").directive("repeatFinishedNotify",function(){return function(e,o,t){e.$last&&(e.hideLoading(),e.setDocVars(),e.continueToExperience("smartS"))}}),angular.module("TopicModule").directive("embedSharedContent",["UserAgentService",function(e){return{restrict:"E",scope:{thisPost:"=embedPost",trustSource:"&",preventNav:"&"},link:function(o,t,n){o.mobileUserAgent=e.getMobileUserAgent()},templateUrl:"partials/shared.html"}}]),angular.module("TopicModule").directive("mediaPlayer",["$sce","UserAgentService",function(e,o){return{restrict:"E",scope:{thisPost:"=",vidIndex:"@"},link:function(t,n,i){function r(e){var o;return e.mediaAspectFeed.y?o="-"+e.mediaAspectFeed.y+"px":e.mediaAspectFull.y&&(o="-"+e.mediaAspectFull.y+"px"),o}function a(e){var o;return e.mediaAspectFeed.x?o="-"+e.mediaAspectFeed.x+"px":e.mediaAspectFull.x&&(o="-"+e.mediaAspectFull.x+"px"),o}t.isMobileUser=o.isMobileUser();var s="iOS"===o.getMobileUserAgent();t.trustSrc=function(o){return e.trustAsResourceUrl(o)};var l=n[0].firstElementChild.childNodes[1],c=n[0].firstElementChild.childNodes[7];$(l).on("waiting",function(){NETWORK_DEBUG&&console.log("Video Waiting"),t.isMobileUser&&!s?(c.className="media-loading-fullscreen",c.style.zIndex="2147483647"):c.className="media-loading"}),$(l).on("stalled",function(){NETWORK_DEBUG&&console.log("Video Stalled"),t.isMobileUser&&!s?(c.className="media-loading-fullscreen",c.style.zIndex="2147483647"):c.className="media-loading"});var d;$(l).on("canplay",function(){d=!0}),$(l).on("playing",function(){NETWORK_DEBUG&&console.log("Video Playing"),c.className="media-loading-default"}),t.togglePlayPause=function(e){var o=n[0].firstElementChild.childNodes,i=o[1],r=o[3],a=o[5],s=o[7];i.paused||i.ended?(a.className="pause",r.className="pause",i.play(),t.isMobileUser&&(i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.msRequestFullscreen&&i.msRequestFullscreen())):(s.className="media-loading-default",a.className="media-controls",r.className="media-thumbnail",i.pause())},t.setAspectRatio=function(e,o){NETWORK_DEBUG;var t=[];return"portrait"===o?1.778===e?t.push("video-portrait-9x16"):t.push("video-portrait-1x2"):"square"===o?t.push("video-square"):1.778===e?t.push("video-landscape-16x9"):t.push("video-landscape-2x1"),t},t.setDimensions=function(e,o,i){var s=n[0].firstElementChild.childNodes,l=s[1],c=$(l).width();NETWORK_DEBUG,t.isMobileUser&&1===e&&c>380?c=381:1===e&&c>300&&(c=300),1.778===e&&c>533&&(c=533),2===e&&c>600&&(c=600);var d={},u=c/e;return(1.778===e||2===e)&&u>300&&(u=300),d.height=u,i&&(d["background-image"]="url("+i.mediaThumbUrl+")",d["background-size"]="cover",d["background-position-y"]=r(i),d["background-position-x"]=a(i)),NETWORK_DEBUG,d}},templateUrl:"partials/mediaPlayer.html"}}]),angular.module("TopicModule").directive("embedPlayer",["$sce","UserAgentService",function(e,o){return{restrict:"E",scope:{thisPost:"="},link:function(t,n,i){t.isMobileUser=o.isMobileUser(),t.trustSrcHtml=function(o){return e.trustAsHtml(o)},t.setAspectRatio=function(e,o){NETWORK_DEBUG;var t=[];return"portrait"===o?1.778===e?t.push("video-portrait-9x16"):t.push("video-portrait-1x2"):"square"===o?t.push("video-square"):1.778===e?t.push("video-landscape-16x9"):t.push("video-landscape-2x1"),t},t.setDimensions=function(e,o,i){var r=n[0].childNodes,a=r[0],s=$(a).width();NETWORK_DEBUG,t.isMobileUser&&1===e&&s>380?s=381:1===e&&s>300&&(s=300),1.778===e&&s>533&&(s=533),2===e&&s>600&&(s=600);var l=s/e;(1.778===e||2===e)&&l>300&&(l=300);var c=a.childNodes[0];$(c).css("height",l),NETWORK_DEBUG}},templateUrl:"partials/embedPlayer.html"}}]),angular.module("TopicModule").directive("imageControl",["$sce","URIHelper",function(e,o){return{restrict:"E",scope:{thisPost:"="},link:function(e,t,n){function i(e,o,t){var n,i;if("y"===o&&e.mediaAspectFeed.y){i=t/e.mediaAspectFeed.h;var r=e.mediaAspectFeed.y*i;n="-"+r+"px"}if("x"===o&&e.mediaAspectFeed.x){i=t/e.mediaAspectFeed.w;var a=e.mediaAspectFeed.x*i;n="-"+a+"px"}return n}var r=t[0];e.imageClick=function(e){$.magnificPopup.open({items:{type:"image",src:e},type:"inline",callbacks:{open:function(){$("body").bind("touchmove",function(e){e.preventDefault()}),o.embedded()&&(console.log("MFP: ",$(".mfp-content").offset()," DOC: ",r.getBoundingClientRect().top),$(".mfp-content").offset()!==r.getBoundingClientRect().top&&(console.log("Shifting MFP"),$(".mfp-content").offset({top:r.getBoundingClientRect().top-100})))},close:function(){$("body").unbind("touchmove")}}})},e.setAspectRatio=function(e,o){NETWORK_DEBUG;var t=[];return"portrait"===o?1.778===e?t.push("image-portrait-9x16"):t.push("image-portrait-1x2"):"square"===o?t.push("image-square"):1.778===e?t.push("image-landscape-16x9"):t.push("image-landscape-2x1"),t},e.setDimensions=function(o,n,r){var a=t[0].childNodes[0],s=$(a).width();NETWORK_DEBUG,e.isMobileUser&&1===o&&s>380?s=381:1===o&&s>300&&(s=300),1.778===o&&s>533&&(s=533),2===o&&s>600&&(s=600);var l={},c=s/o;return(1.778===o||2===o)&&c>300&&(c=300),l.height=c,r&&(l["background-image"]="url("+r.mediaUrl+")",l["background-size"]="cover",l["background-position-y"]=i(r,"y",c)||"",l["background-position-x"]=i(r,"x",s)||""),NETWORK_DEBUG,l}},templateUrl:"partials/imageControl.html"}}]),angular.module("NetworkModule").service("DataService",["TopicService","CommentService","ReplyService","ChannelService","SocialService","VideoService",function(e,o,t,n,i,r){function a(t){if(t.error)console.log("Comments Error message from network: ",t.error);else if(t.push)"UPSERT"==t.method&&(0==o.updateComment(t)?e.updateCommentCount(1):"REMOVE"==t.method);else if("POST"==t.method){var n=t.uri;if(void 0!=n){var i=n.slice(-m);"/v1.0/comment/create"==n?(o.appendToComments(t),e.updateCommentCount(1)):0==o.updateCommentLocalData(n,i)&&e.updateCommentCount(-1)}}else o.setComments(t)}function s(o){o.error?console.log("Topic Error message from network: ",o.error):o.push?"UPSERT"==o.method?e.updateTopic(o.data):"REMOVE"==o.method&&e.removeTopic(o.data):e.setTopic(o)}function l(e){if(e.error)console.log("Topic Error message from network: ",e.error);else if(e.push)console.log("reply pushed "),"UPSERT"==e.method&&(0===t.updateReply(e)?void 0!=e.data&&o.updateReplyCountById(e.data.commentId,1):"REMOVE"==e.method);else if("POST"==e.method){var n=e.uri;if(void 0!=n){var i=n.slice(-m);if("/v1.0/reply/create"==n)t.appendToReplies(e),void 0!=e.data&&o.updateReplyCountById(e.data.commentId,1);else{var r=t.getCommentIdByReply(i);0==t.updateReplyLocalData(n,i)&&o.updateReplyCountById(r,-1)}}}else t.setReplies(e)}function c(e){e.error?console.log("Topic Error message from network: ",e.error):(console.log("delegateSetChannel: ",e),n.setTopicData(e))}function d(e){e.error?console.log("Social Error message from network: ",e.error):(console.log("SOCIAL GET"),i.setSocialData(e))}function u(e){e.error?console.log("Video Error message from network: ",e.error):(console.log("VIDEO GET"),r.setVideoData(e))}var m=16;return{setVideo:u,setSocial:d,setChannel:c,setTopic:s,setComments:a,setReplies:l,setWatchTopic:function(o){e.setWatchTopic(o)}}}]),angular.module("TopicModule").factory("TopicService",["DateUtilityService","Bant","FDSUtility",function(e,o,t){function n(t){void 0!=t.data?(void 0!=t.data.content&&(v=t.data.content.title),f=t.data.topicType,console.log("TOPIC TYPE :"+f),h=t.data.id,"livegame"==f&&(T=t.data.game,void 0!=T&&(C=-1!==T.id.indexOf("cricket")?!0:!1,y=e.getGameScheduledTime(T.scheduledAt),w=T.score,w.live||w["final"]||w.cancel?w.live===!0?S="live":w["final"]===!0?(S="past",T.score.summary&&(U=T.score.summary)):w.cancel===!0&&(S="canceled"):S="future","live"==S&&(console.log("_gameStats"+w.status),b=w.status))),g=o.bant(t.data),N()):"POST"==t.method&&(t.uri==R+h?(NETWORK_DEBUG&&console.log("Topic watch success"),D=!0):t.uri==I+h?(NETWORK_DEBUG&&console.log("Topic liked success"),g=o.updateBantLiked(g,!0),N()):t.uri==M+h&&(NETWORK_DEBUG&&console.log("Topic unliked success"),g=o.updateBantLiked(g,!1),N()))}function i(e){console.log("Topic Service scoreData :"+e),r(e)}function r(e){w=e,void 0!=w&&(1==w.live&&(S="live"),b=w.status,console.log("Game Points :"+w.points[0]+" : : "+w.points[1]),console.log("Game Period :"+b[0]),console.log("Game Period :"+b[1]),N())}function a(e){console.log("Update comment count: "+g.metrics.comments+"     Value : "+e),void 0!=g&&void 0!=g.metrics&&(1==e?void 0==g.metrics.comments?g.metrics.comments=1:g.metrics.comments=g.metrics.comments+1:void 0==g.metrics.comments?g.metrics.comments=0:g.metrics.comments=g.metrics.comments-1),N()}function s(e){var o=A+e;return varTopicParams={rid:"topic",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(o)}}function l(){var e=0;void 0!=g&&void 0!=g.owner&&(e=g.owner.id),p=e;var o="/v1.0/channel/follow/"+e;return varTopicParams={rid:"topic",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(o)}}function c(e){var o=R+e;return varTopicParams={rid:"topic",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(o)}}function d(){return console.log("Like topic request invoked"+h),varLikeParams={rid:"topic",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(I+h)}}function u(){return varLikeParams={rid:"topic",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(M+h)}}function m(e){for(var o=O.length;o>0;)o=O.length,O.pop();O.push(e)}var p,g,f,h,v,T,S,w,b,y,U,C,E,k,A="/v1.0/topic/show/",I="/v1.0/topic/like/",M="/v1.0/topic/unlike/",R="/v1.0/topic/watch/",D=!1,O=[],N=function(){angular.forEach(O,function(e){e()})};return{getTopic:function(){return g},getTopicId:function(){return h},getTopicType:function(){return f},getGame:function(){return T},getGameTime:function(){return y},getTeamA:function(){return void 0!=T?T.teams[0]:void 0},getTeamB:function(){return void 0!=T?T.teams[1]:void 0},getScoresTitle:function(){return void 0!=T&&void 0!=T.links?T.links[0].title:void 0},getScoresLink:function(){return void 0!=T&&void 0!=T.links?T.links[0].url:void 0},getScore:function(){return void 0!=w?w:void 0},getGameStatus:function(){return S},getGamePeriod:function(){return b?b[0]:void 0},getGameClock:function(){return b?b[1]:void 0},getGameSummary:function(){return U},getOffense:function(){var e={};return w.detail&&(w.detail[0].offense?(e.team="leftTeam",e.position=w.detail[0].position):w.detail[1].offense&&(e.team="rightTeam",e.position=w.detail[1].position)),e},isGameCricket:function(){return C},getChannelId:function(){return void 0!=g?g.owner.id:void 0},getTitle:function(){return v},getHtml:function(){return void 0!=g?g.html:void 0},getTimeCreatedAt:function(){return void 0!=g?g.createdAt:void 0},getLiked:function(){return void 0!=g?g.signal.like:void 0},getMetrics:function(){return void 0!=g?g.metrics:void 0},watchTopicRequest:c,getLikeTopicRequest:d,getUnlikeTopicRequest:u,getFollowChannelRequest:l,getTopicRequest:s,isWatchingTopic:function(){return D},setWatchTopic:function(e){D=e},setTopicId:function(e){h=e},setChannel:function(e){p=e},getChannel:function(){return p},setTopic:n,updateTopic:i,updateCommentCount:a,registerObserverCallback:m,directComment:E,currentTimer:function(e){if(e===!1){console.log("$AUTO$ PREV TIMER FOUND");var o=k;return k=void 0,o}return e&&(console.log("$AUTO$ STORE TIMER PROMISE"),k=e),k}}}]),angular.module("SplashModule",[]).factory("SplashService",function(){var e=!0,o=!0;return{hidePeelSplash:function(){return e},hideSSSplash:function(){return o},setPeelSplash:function(o){e=o},setSSSplash:function(e){o=e}}}),angular.module("NetworkModule").factory("CommentService",["Bant","DateUtilityService","FDSUtility","URIHelper",function(e,o,t,n){function r(o){if($=[],tempCommentsData=o.data.results,void 0!=tempCommentsData&&tempCommentsData.length>0){var t=tempCommentsData.length;for(i=0;i<t;i++){var n={};n=e.bant(tempCommentsData[i]),void 0!=n.id&&$.push(n)}NETWORK_DEBUG&&console.log("Set Comments"),K(!0),W=o.data.nextOffset}else{var r=o.data;if("GET"==o.method&&o.uri.substring(0,I.length)==I){NETWORK_DEBUG&&console.log("Processing Show comment");var n={};n=e.bant(r),void 0!=n.id&&$.push(n),K(!0)}}}function a(o){var t=o.data;if(void 0!=t){var n={};if(n=e.bant(t),void 0!=n.id){var i=0;if($.length>0)for(;1==$[i].pin;)i++;G=i,G>0?$.splice(i,0,n):$.unshift(n)}}K()}function s(o){var t=o.data;for(i=0;i<$.length;i++)if($[i].id==t.id)return $[i]=e.bant(t),1;return a(o),NETWORK_DEBUG&&console.log("In Comment Service update comment"),0}function l(e){for(i=0;i<$.length;i++)if($[i].id==e.id)return void($[i]=e)}function c(o,t){if(NETWORK_DEBUG&&console.log("updateLikeCommentWithId :"+o+"   liked "+t),void 0!=o){var n;n=u(o),n=e.updateBantLiked(n,t),l(n),K(!0)}}function d(e){var o=e.data;for(i=0;i<$.length;i++)if($[i].id==o.id)return $.splice(i,1),0;return 1}function u(e){for(NETWORK_DEBUG&&console.log("_comments :"+$.length),i=0;i<$.length;i++)if($[i].id==e)return $[i]}function m(e,o){if(o){for(var t=L.length;t>0;)t=L.length,L.pop();L.push(e)}else{for(var t=x.length;t>0;)t=x.length,x.pop();x.push(e)}}function p(e){var o;return o=0===W?"?limit=10&offset="+W:"?offset="+W,{rid:"comment",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(e+o)}}function g(e){return{rid:"comment",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(e)}}function f(e){var o=A+e;return p(o)}function h(e){var o=I+e;return p(o)}function v(e,o){var t=g(M);return t.data={lang:"en",content:{sections:[{type:"html",html:o}]},topicId:e},t}function T(e,o,t){var n={media:[t]},i=g(M);return i.data={lang:"en",content:{sections:[{type:"html",html:o},{type:"media"}]},topicId:e},i.data.content.sections[1].media=n.media,NETWORK_DEBUG&&console.log("Media comment Request :"+JSON.stringify(i,null,10)),i}function S(e,o,t){var n=g(M);return n.data={lang:"en",content:{sections:[{type:"html",html:o},{type:"embed"}]},topicId:e},n.data.content.sections[1].embed=t,NETWORK_DEBUG&&console.log("Media comment Request :"+JSON.stringify(n,null,10)),n}function w(e){return g(D+e)}function b(e){return g(O+e)}function y(e){return g(P+e+"?reason=spam")}function U(e){return g(R+e)}function C(e){return t.isLikedById($,e)}function E(e,o){if(void 0!=e){var t=u(e);void 0!=t&&(NETWORK_DEBUG&&console.log("found element :"+t+" tempStructure.metrics.replies :"+t.metrics.replies),-1==o?void 0==t.metrics.replies?t.metrics.replies=0:t.metrics.replies=t.metrics.replies-1:void 0==t.metrics.replies?t.metrics.replies=1:t.metrics.replies=t.metrics.replies+1,l(t),NETWORK_DEBUG&&console.log("found element updated to :"+t+" tempStructure.metrics.replies :"+t.metrics.replies),K())}}function k(e,o){if(e==D+o)c(o,!0);else if(e==O+o)c(o,!1);else{if(e==R+o)return $=t.deleteById($,o),K(),0;e==P+o?$=t.flagById($,!1):e==B+o?$=t.flagById($,!1):e==N+o?$=t.hideById($,!0):e==F+o&&($=t.hideById($,!1))}}var A="/v1.0/topic/comments/list/",I="/v1.0/comment/show/",M="/v1.0/comment/create",R="/v1.0/comment/delete/",D="/v1.0/comment/like/",O="/v1.0/comment/unlike/",N="/v1.0/comment/hide/",F="/v1.0/comment/unhide/",P="/v1.0/comment/flag/",B="/v1.0/comment/unflag/",x=[],L=[],$=[],G=0,W=0,_=!1,K=function(e){e?angular.forEach(L,function(e){e()}):angular.forEach(x,function(e){e()})};return{comments:function(){return $},setComments:r,updateComment:s,appendToComments:a,updateLikeCommentWithId:c,updateCommentLocalData:k,updateReplyCountById:E,removeComment:d,postCommentRequest:v,postCommentRequestForMedia:T,postCommentRequestForShare:S,getLikeCommentRequest:w,getUnlikeCommentRequest:b,registerObserverCallback:m,getCommentsRequest:f,getCommentById:u,getCommentByIdRequest:h,deleteCommentRequest:U,flagCommentRequest:y,isCommentLiked:C,getNumPinComments:function(){return G},loadedComments:function(){return _},setLoadedComments:function(e){_=e}}}]),angular.module("SocialModule").factory("VideoService",["Bant",function(e){function o(o){d=[];var t=o.data.results,n=t?t.length:0;if(t&&n>0){for(var i=!1,r=0;n>r;r++){var a=e.bant(t[r]);if(a.expert="Twitter:Expert"===t[r].source.type?!0:!1,!i&&a.expert&&(i=!0),a.id){for(var s=!0,l=0;l<u.length;l++)if(u[l].id===a.id){s=!1;break}if(d.push(a),1===n&&s&&"video_auto"===o.rid)return GEN_DEBUG&&console.log("$AUTO$ SINGLE REQUEST FOUND NEW VIDEO - NOTIFYING"),void h("new");s&&"video_auto"===o.rid&&u.push(a)}}"video"===o.rid?(m=o.data.nextOffset,h()):(i&&(f=!0),h(!0))}}function t(e,o){if(o===!0){for(var t=l.length;t>0;)t=l.length,l.pop();l.push(e)}else if("new"===o){for(var t=c.length;t>0;)t=c.length,c.pop();c.push(e)}else{for(var t=s.length;t>0;)t=s.length,s.pop();s.push(e)}}function n(e,o){var t=m,n={rid:"video",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(a+e+"?limit="+p+"&offset="+t+"&filter=video")};return NETWORK_DEBUG&&console.log("Video Request: ",n),n}function i(e){var o={rid:"video_auto",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(a+e+"?limit="+p+"&offset=0&filter=video")};return NETWORK_DEBUG&&console.log("Video Request Auto: ",o),o}function r(e){var o={rid:"video_auto",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(a+e+"?limit=1&offset=0&filter=video")};return NETWORK_DEBUG&&console.log("Video Request Single Auto: ",o),o}var a="/v1.0/channel/social/list/",s=[],l=[],c=[],d=[],u=[],m=0,p=10,g=0,f=!1,h=function(e){e===!0?angular.forEach(l,function(e){console.log("Notify observer in autoRequest ",e),e()}):"new"===e?angular.forEach(c,function(e){console.log("Notify observer in newRequest ",e),e()}):angular.forEach(s,function(e){e()})};return{videoArray:function(){return d},resetVideoOffset:function(){m=0},setVideoData:o,getVideoDataRequest:n,getVideoDataRequestAuto:i,getVideoDataRequestAutoSingle:r,registerObserverCallback:t,videoArrayAutoLength:function(){return u.length},getPrevLength:function(){return g},setPrevLength:function(e){g=e},newExpertIn:function(e){return void 0===e?(console.log("$AUTO$ EXPERT? ",f),f):(f=e,void console.log("$AUTO$ EXPERT SET: ",f))}}}]),angular.module("NetworkModule").service("DateUtilityService",function(){function e(e){var o=new Date,t=new Date(e);if(secondsPast=(o.getTime()-t.getTime())/1e3,secondsPast<60)return"now";if(secondsPast<3600)return parseInt(secondsPast/60)+"m";if(secondsPast<86400)return parseInt(secondsPast/3600)+"h";if(secondsPast<2592e3){var n=secondsPast/86400;return Math.floor(n)+"d"}return secondsPast>2592e3?(day=t.getDate(),month=t.toDateString().match(/ [a-zA-Z]*/)[0].replace(" ",""),year=t.getFullYear()==o.getFullYear()?"":" "+t.getFullYear(),console.log("DATE "+day+" "+month+year),day+" "+month+year):void 0}function o(e){var o="12",t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=new Date(e),r=i.getDate(),a=t[i.getDay()],s=i.getMonth()+1,l=n[i.getMonth()],c=i.getHours(),d=i.getMinutes(),u=c,m="";i.toLocaleString("en",{timeZoneName:"short"}).split(" ").pop();"12"==o&&(c>12?(m="PM",c-=12,10>c?u="0"+c:12==c&&(c="00",m="AM")):12>c?(u=10>c?"0"+c:c,m="AM"):12==c&&(m="PM")),10>d&&(d="0"+d),u=u+":"+d+" "+m;var p=s+"/"+r,g=a+", "+l+" "+r;return result={date:p,time:u,dateExt:g},console.log("Scheduled date : "+result.date+"  Scheduled time : "+result.time),console.log("Scheduled Date, Extended Format: ",result.dateExt),result}return{getTimeSince:e,getGameScheduledTime:o}}),angular.module("NetworkModule").factory("Bant",["DateUtilityService",function(e){function o(e,o){return e.mediaType=o.mediaType.substring(r,0),"video"==e.mediaType&&(e.mediaThumbUrl=o.thumbUrl),e.mediaUrl=o.url,void 0!=o.sizes&&(e.mediaAspectFull=o.sizes.full,e.mediaAspect16x9=o.sizes["16:9"],e.mediaAspect1x1=o.sizes["1:1"],e.mediaAspect2x1=o.sizes["2:1"]),void 0!=e.mediaAspect16x9?(e.mediaAspectRatio=1.778,e.mediaAspectFeed=e.mediaAspect16x9,e.mediaAspect16x9.w<e.mediaAspect16x9.h?e.mediaOrientation="portrait":e.mediaOrientation="landscape"):void 0!=e.mediaAspect1x1?(e.mediaAspectRatio=1,e.mediaAspectFeed=e.mediaAspect1x1,e.mediaOrientation="square"):void 0!=e.mediaAspect2x1&&(e.mediaAspectRatio=2,e.mediaAspectFeed=e.mediaAspect2x1,e.mediaAspect2x1.w<e.mediaAspect2x1.h?e.mediaOrientation="portrait":e.mediaOrientation="landscape"),void 0!=e.mediaAspectFeed&&(void 0==e.mediaAspectFeed.x?0:e.mediaAspectFeed.x,void 0==e.mediaAspectFeed.y?0:e.mediaAspectFeed.y,void 0==e.mediaAspectFeed.w?0:e.mediaAspectFeed.w,void 0==e.mediaAspectFeed.h?0:e.mediaAspectFeed.h),void 0!=e.mediaAspectFull&&(void 0==e.mediaAspectFull.x?0:e.mediaAspectFull.x,void 0==e.mediaAspectFull.y?0:e.mediaAspectFull.y,void 0==e.mediaAspectFull.w?0:e.mediaAspectFull.w,void 0==e.mediaAspectFull.h?0:e.mediaAspectFull.h),e}function t(t,n){return t.embedType=n.type,t.embedTitle=n.title,t.embedText=n.text,t.embedMedia={},("media"===n.type||"link"===n.type)&&n.media&&(t.embedMedia=o(t.embedMedia,n.media[0])),t.embedUrl=n.url,t.embedPlayable=n.playable,t.embedHtml=n.html,t.embedMetrics=n.metrics,t.embedMini=n.mini,t.embedAuthor=n.author,t.embedProvider=n.provider,t.embedCreatedAt=e.getTimeSince(n.createdAt),t.embedCreatedAtFull=n.createdAt,t}function n(n){var i={};if(i.id=n.id,i.author=n.author,i.owner=n.owner,void 0!=n.content.sections)for(i.sectionsLength=n.content.sections.length,j=0;j<i.sectionsLength;j++)i.type=n.content.sections[j].type,"html"==i.type&&(i.html=n.content.sections[j].html),"media"==i.type&&(i.media=n.content.sections[j].media,i=o(i,i.media[0])),("embed"==i.type||"tweet"==i.type)&&null!==n.content.sections[j].embed&&(i=t(i,n.content.sections[j].embed),i.embed=n.content.sections[j].embed),i.tweet=n.content.sections[j].tweet,i.ogp=n.content.sections[j].ogp,i.link=n.content.sections[j].link;if(i.signal=n.signal,void 0==i.signal){var r={like:!1};i.signal=r}else void 0==i.signal.like&&(i.signal.like=!1);return i.metrics=n.metrics,i.createdAtFull=n.createdAt,i.createdAt=e.getTimeSince(n.createdAt),i.pin=n.pin,i.commentId=n.commentId,i.topicId=n.topicId,i}function i(e,o){return e.signal.like==o?(NETWORK_DEBUG&&console.log("no need to change   data.signal.like:"+e.signal.like),e):(o?(e.signal.like=!0,void 0==e.metrics.likes?e.metrics.likes=1:e.metrics.likes=e.metrics.likes+1):(e.signal.like=!1,void 0!=e.metrics.likes&&(e.metrics.likes=e.metrics.likes-1)),NETWORK_DEBUG&&console.log("data.metrics.likes :"+e.metrics.likes),e)}var r=5;return{bant:n,updateBantLiked:i}}]),angular.module("NetworkModule").factory("UserInfoService",["ForumStorage","URIHelper",function(e,o){function t(){return void 0==a?(NETWORK_DEBUG&&console.log("UserInfoService : UserId is not defined , using static user, TODO : Remove this for release build"),a=s,s):a}function n(e){return e==a.userId?!0:!1}function i(o,t,n,i){NETWORK_DEBUG&&console.log("setUserCredentials: ",o,t,n,i),a.userId=o,a.accessToken=t,a.sessionId=n,l=!0,a.userType=i,e.setToLocalStorage("forumIsLoggedIn",l),e.setToLocalStorage("forumUserId",o),e.setToLocalStorage("forumAccessToken",t),e.setToLocalStorage("forumSessionId",n),e.setToLocalStorage("forumUserType",i)}function r(){return e.getFromLocalStorage("hasUserVisited")?!0:!1}var a={},s={userId:"193",accessToken:"dsKGKXyZgGs=",sessionId:"53d7b518"},l=!1;return{getUserCredentials:t,setUserCredentials:i,isCurrentUser:n,hasUserVisited:r,isUserLoggedIn:function(){return l?!0:e.getFromLocalStorage("forumIsLoggedIn")?(a={},a.userId=e.getFromLocalStorage("forumUserId"),a.accessToken=e.getFromLocalStorage("forumAccessToken"),a.sessionId=e.getFromLocalStorage("forumSessionId"),!0):!1},isPeelUser:function(){var t=o.isPeelUser();return NETWORK_DEBUG&&console.log("ForumStorage.getFromLocalStorage: "+e.getFromLocalStorage("forumUserType")),t?!0:"peel"===a.userType?!0:"peel"===e.getFromLocalStorage("forumUserType")?!0:!1},isSmartStadiumUser:function(){var t=o.isSmartStadiumUser();return NETWORK_DEBUG&&console.log("ForumStorage.getFromLocalStorage: ",e.getFromLocalStorage("forumUserType")),t?(a.userType="email",!0):"email"===a.userType?!0:"email"===e.getFromLocalStorage("forumUserType")?!0:!1},isMI16User:function(){var t=o.isTechMUser();return NETWORK_DEBUG&&console.log("ForumStorage.getFromLocalStorage: ",e.getFromLocalStorage("forumUserType")),t?(a.userType="MI16",!0):"MI16"===a.userType?!0:"MI16"===e.getFromLocalStorage("forumUserType")?!0:!1},isMWCUser:function(){var t=o.isMWCUser();return NETWORK_DEBUG&&console.log("ForumStorage.getFromLocalStorage: ",e.getFromLocalStorage("forumUserType")),t?(a.userType="MWC",!0):"MWC"===a.userType?!0:"MWC"===e.getFromLocalStorage("forumUserType")?!0:!1},getUserType:function(){return a.userType},isGuestUser:function(){return"guest"===a.userType||"guest"===e.getFromLocalStorage("forumUserType")?!0:!1}}}]),angular.module("AuthModule").factory("AuthService",["$http","$window","$location","UserInfoService","TopicService","ReplyService","networkService","ForumDeviceInfo","ChannelService","URIHelper",function(e,o,t,n,i,r,a,s,l,c){var d=!1,u=function(e){NETWORK_DEBUG&&console.log("Logging in as Guest");var o={};o.id=s.getDeviceId(),o.userName="GuestUser";var t=h("guest",-28800,o);v(t,null,e)},m=function(e){FB.login(function(o){if("connected"===o.status){e();var t=h("facebook",-25200,o.authResponse);v(t)}})},p=function(e){var o={};o.id=c.getPeelUserId(),o.userName=c.getPeelUserName();var t=h("peel",-28800,o);v(t,null,e)},g=function(e){var o={id:c.getSSUserId(),userName:c.getSSUserName()},t=h("email",-28800,o);v(t,null,e)},f=function(e,o,t){var n={id:o,userName:e};NETWORK_DEBUG&&console.log("techMLogin: ",n);var i=h("email",-28800,n);v(i,t)},h=function(e,o,t){var n=s.getDeviceId(),i={type:e,locale:"en_US",utcOffset:o,deviceType:"web",deviceId:n,deviceModel:"browser",appKey:"testKey",appVersion:"1.0"};return"facebook"===e?i.facebook={id:t.userID,accessToken:t.accessToken}:"peel"===e?i.peel={id:t.id,name:t.userName}:"email"===e&&(i.email={id:t.id,name:t.userName}),i},v=function(o,t,i){var r=o.type;t&&(r=t),e.post(REGISTER_SERVER_URI,JSON.stringify(o)).then(function(e){200===e.status&&(NETWORK_DEBUG&&console.log("Successfully Registered User of Type: "+r),"facebook"===o.type&&(d=!0),n.setUserCredentials(e.data.userId,e.data.accessToken,e.data.sessionId,r))},function(e){NETWORK_DEBUG&&console.log("Registration Error: ",e)}).then(function(e){T(i)})},T=function(e){NETWORK_DEBUG&&console.log("Initializing Content"),a.init();var o=l.getChannel(),n=i.getTopicId();if(o)NETWORK_DEBUG&&console.log("found channel ID: "+o),a.send(l.getLiveGameTopic(o));else if(n){if(-1!==window.location.href.indexOf("?")){var s=window.location.href.slice(window.location.href.indexOf("?")+1);console.log("Auth UrlQueryStr: ",s)}NETWORK_DEBUG&&console.log("found Topic ID: "+n),e?(console.log("Auth Topic CB"),e()):s?(console.log("Auth Topic Redirect w/ Query"),t.url("/topic/"+n+"?"+s)):(console.log("Auth Topic Redirect w/Out Query"),t.url("/topic/"+n))}else{var c=r.getPostId();c&&(NETWORK_DEBUG&&console.log("found post ID: "+c),t.url("/post/"+c))}};return{loginAsGuest:u,loginToFacebook:m,loginWithPeel:p,loginWithEmail:g,techMLogin:f,setRegistrationParams:h,registerUser:v,initializeContent:T,userLoggedInToFacebook:d}}]),angular.module("NetworkModule").service("StaticData",function(){function e(){for(var e=[],o=["fakePhoto1.jpg","fakePhoto2.jpg","fakePhoto3.jpg","fakePhoto4.jpg","fakePhoto5.jpg","fakePhoto6.jpg"],i=0,r=["fakeVideo1.jpg","fakeVideo2.jpg","fakeVideo3.jpg"],a=0,s=[{type:"photo",postContent:"Will this be the year Kaep teaches Sherman a lesson or will Kaep get schooled again?",postMedia:"fakePhoto1.jpg"
},{type:"video",postContent:"Remember Kyle Williams - for some reason, I am having recurring nightmares about him again - weird but true:(",postMedia:"fakeVideo1.jpg"},{type:"photo",postContent:"Will Kaep be given a free reign to do whatever he wants? Please don't make him a pocket passer because HE IS NOT ONE",postMedia:"fakePhoto2.jpg"},{type:"video",postContent:"Running back of the 9ers this season truly scares the hell out of me - thoughts?",postMedia:"fakeVideo2.jpg"},{type:"video",postContent:"Will our defense save us again? We have seen that this offense needs lot of help:(",postMedia:"fakeVideo3.jpg"},{type:"photo",postContent:"Can't wait for this game - gets me want to kick Seahawks every time we play them",postMedia:"fakePhoto3.jpg"},{type:"text",postContent:"Jimmy Graham is going to be such a formidable match-up for our secondary. Not sure if we have the personnel to cover him. Hate the fact that the saehawks offense just got whole lot better this year",postMedia:""},{type:"text",postContent:"From contenders to last in the league - reasons for our free fall down the ranks",postMedia:""},{type:"text",postContent:"One more drubbing - when are we going to be good again?",postMedia:""},{type:"text",postContent:"How do we always fuck up the second half? It is always the take of two halves with us this year. Sucks",postMedia:""},{type:"text",postContent:"Are you fuckin kidding me - how did we miss that tackle? Why do we keep messing up defensively during 3rd and long? That is the 5th 3rd and long conversion for the Hawks.. Come on DDDDD",postMedia:""},{type:"text",postContent:"Time to talk about the next season already? Sure nothing is going to change and we are going to suck again.. ",postMedia:""},{type:"text",postContent:"We miss Aldon Smith so much - we absolutely don't have an edge rusher.. what a jack-ass.. blew away so much second chances:(",postMedia:""}],l=0;l<s.length;l++){var c=s[l],d=new Object;d.postID=l;var u=20,m=u+Math.round(Math.random()*(n.length-u));n.substring(0,m);d.postContent=c.postContent;var p=c.type;if(d.postType=p,"photo"==p){var g=o[i%o.length];d.photo=g,i++}else if("video"==p){var f=r[a%r.length];d.video=f,a++}var h=t[l%t.length];d.postAuthorPhoto=h.photo,c.postAuthorPhoto=h.photo,d.postAuthorName=h.name,c.postAuthorName=h.name,d.likeCount=Math.floor(100*Math.random()),c.likeCount=Math.floor(100*Math.random()),d.commentCount=Math.floor(500*Math.random()),c.commentCount=Math.floor(500*Math.random()),e.push(c)}return e}function o(){for(var e=[],o=0;10>o;o++){var i=new Object;i.postID=o;var r=20,a=r+Math.round(Math.random()*(n.length-r)),s=n.substring(0,a);i.replyContent=s,i.replyType="text";var l=t[o%t.length];i.postAuthorPhoto=l.photo,i.postAuthorName=l.name,i.likeCount=Math.floor(100*Math.random()),i.commentCount=Math.floor(500*Math.random()),e.push(i)}return e}var t=[{photo:"ana.png",name:"Ana"},{photo:"arod.png",name:"A-Rod"},{photo:"cristiano.png",name:"Cristiano"},{photo:"derek.png",name:"Derek"},{photo:"dwayne.png",name:"Dwayne"},{photo:"erin.png",name:"Erin"},{photo:"jordan.png",name:"Michael"},{photo:"lebron.png",name:"Lebron"},{photo:"lionel.png",name:"Lionel"},{photo:"maria.png",name:"Maria"}],n="Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris";return{getPostsForTopicID:e,getRepliesForPostID:o}}),angular.module("NetworkModule").factory("FDSUtility",function(){function e(e,o){for(NETWORK_DEBUG&&console.log("structureLengths :"+e.length),i=0;i<e.length;i++)if(e[i].id==o)return e[i]}function o(e,o){for(NETWORK_DEBUG&&console.log("structureLengths :"+e.length),i=0;i<e.length;i++)if(e[i].id==o)return i;return-1}function t(o,t){var n=e(o,t);return void 0!=n&&(NETWORK_DEBUG&&console.log("found element :"+n+" tempStructure.signal.like :"+n.signal.like),1==n.signal.like)?!0:!1}function n(o,t){var n=e(o,t);return void 0!=n&&(NETWORK_DEBUG&&console.log("found element :"+n+" tempStructure.signal.flag :"+n.signal.flag),1==n.signal.flag)?!0:!1}function r(o,t,n){var i=e(o,t);void 0!=i&&(NETWORK_DEBUG&&console.log("found element :"+i+" tempStructure.signal.flag :"+i.signal.flag),i.signal.flag=n)}function a(e,t){var n=o(e,t);return-1!=n&&(NETWORK_DEBUG&&console.log("found element at:"+n),e.splice(n,1)),e}return{isLikedById:t,isFlaggedById:n,flagById:r,deleteById:a}}),angular.module("MediaModule",["angularFileUpload","NetworkModule","TopicModule"]).factory("MUService",function(){function e(){var e={rid:"comment",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(n)};return e.data={lang:"en",topicId:s},r||(e={rid:"reply",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(i)},e.data={lang:"en",topicId:s},e.data.target={type:"comment",id:l},e.data.commentId=l),e}function o(e,o,t,n,i){void 0===o&&(o=""),console.log("Setting Comment Params: ",e,o,t,n,i),s=e,a=o,r=t,l=n,c=i}function t(o){var t={media:[o]},n=[];void 0!==a&&n.push({type:"html",html:a}),n.push({type:"media",media:t.media});var i=e(),r={sections:n};return i.data.content=r,console.log("Media comment Request :"+JSON.stringify(i,null,10)),i}var n="/v1.0/comment/create",i="/v1.0/reply/create",r=!0,a="",s="",l="",c="";return{postMediaRequest:t,setCommentParams:o,resetCommentParams:function(){s="",l="",a=""}}});
//# sourceMappingURL=app.min.js.map
