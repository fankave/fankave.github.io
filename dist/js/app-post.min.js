angular.module("PostModule",["NetworkModule","SplashModule","MediaModule","angularFileUpload"]).controller("PostController",["$scope","$sce","$timeout","$window","$location","$sanitize","$routeParams","networkService","ReplyService","TopicService","CommentService","UserInfoService","URIHelper","SplashService","MUService","FileUploader","ForumStorage","UserAgentService",function(e,t,o,n,r,a,l,s,d,c,m,p,u,g,h,f,v,y){function b(){e.leftTeam=c.getTeamA(),e.rightTeam=c.getTeamB();var t=c.getScore();void 0!=t&&(e.leftTeamScore=t.points[0],e.rightTeamScore=t.points[1]),e.gameStatus=c.getGameStatus(),e.topicTitle=c.getTitle(),"live"==e.gameStatus&&(e.gamePeriod=c.getGamePeriod(),e.gameClock=c.getGameClock()),console.log("Scores updated in replies")}function A(t){if(console.log("Already Had PostID: ",e.postID),e.postID||(e.postID=d.getPostId(),console.log("Regenerated PostID: ",e.postID)),void 0==t&&(t=m.getCommentById(e.postID)),void 0!=t){NETWORK_DEBUG&&console.log("Updated comment in reply triggered");var o={};o=t,o.postAuthorName=t.author.name,o.postAuthorPhoto=t.author.photo,o.postTimestamp=t.createdAt,o.likeCount=t.metrics.likes,o.replyCount=t.metrics.replies,o.mediaAspectFeed=t.mediaAspectFeed,o.isLiked=t.signal.like,o.topicId=t.topicId,o.isMyComment=p.isCurrentUser(t.author.id),"media"===o.type&&(o.mediaUrl=t.mediaUrl,o.mediaAspectFeed=t.mediaAspectFeed,o.mediaAspectFull=t.mediaAspectFull,o.mediaAspectRatio=t.mediaAspectRatio,o.mediaOrientation=t.mediaOrientation,o.mediaThumbUrl=t.mediaThumbUrl),"embed"===o.type&&(o.shared=!0,o.embed=t.embed,o.embed.embedCreatedAt=t.embedCreatedAt,o.embed.embedCreatedAtFull=t.embedCreatedAtFull,"media"===o.embedType&&(o.mediaUrl=t.embedMedia.mediaUrl,o.mediaThumbUrl=t.embedMedia.mediaThumbUrl,o.mediaAspectFeed=t.embedMedia.mediaAspectFeed,o.mediaAspectFull=t.embedMedia.mediaAspectFull,o.mediaAspectRatio=t.embedMedia.mediaAspectRatio,o.mediaOrientation=t.embedMedia.mediaOrientation),"Twitter"===o.providerName?o.embed.embedLogo="img/twitterLogo@2x.png":o.embed.embedLogo=t.embed.provider.logo,"link"===t.embed.type&&t.embed.playable===!0&&(o.embedHtml=t.embedHtml)),e.comment=o}}function R(){var o=d.replies(),n=o.length;for(e.replies=[],i=0;i<n;i++){var r={};r=o[i],r.postAuthorName=o[i].author.name,r.postAuthorPhoto=o[i].author.photo,r.isMyReply=p.isCurrentUser(o[i].author.id),r.postTimestamp=o[i].createdAt,r.likeCount=o[i].metrics.likes,r.replyCount=o[i].metrics.replies,r.mediaAspectFeed=o[i].mediaAspectFeed,r.isLiked=o[i].signal.like,"media"===r.type&&(r.mediaUrl=o[i].mediaUrl,r.mediaAspectFeed=o[i].mediaAspectFeed,r.mediaAspectFull=o[i].mediaAspectFull,r.mediaAspectRatio=o[i].mediaAspectRatio,r.mediaOrientation=o[i].mediaOrientation,r.mediaThumbUrl=o[i].mediaThumbUrl),"embed"===r.type&&(r.shared=!0,r.embed=o[i].embed,r.embed.embedCreatedAt=o[i].embedCreatedAt,r.embed.embedCreatedAtFull=o[i].embedCreatedAtFull,"Twitter"===r.providerName?r.embed.embedLogo="img/twitterLogo@2x.png":r.embed.embedLogo=o[i].embed.provider.logo,"link"===o[i].embed.type&&o[i].embed.playable===!0&&(r.embed.embedHtml=t.trustAsHtml(o[i].embedHtml))),e.replies.push(r),"media"==e.replies[i].type}1==e.justReplied&&setTimeout(function(){console.log("Scroll to last reply"),window.scrollTo(0,document.body.scrollHeight),e.justReplied=!1},1e3)}y.isMobileUser()?(e.mobileBrowser=!0,e.mobileUserAgent=y.getMobileUserAgent(),console.log("MOBILE USER AGENT: ",e.mobileUserAgent)):e.mobileBrowser=!1,v.getFromLocalStorage("hasUserVisited")===!0&&(console.log("Checking For Existing Session"),e.initPage());e.pageClass="page-post",e.postID=l.postID,e.topicId=c.getTopicId(),e.justReplied=!1,d.setPostId(l.postID),e.backToTopicButtonTapped=function(){var t=c.getTopicId();void 0==t&&(t=e.comment.topicId),HTML5_LOC?r.path("/topic/"+t):n.location="#/topic/"+t},e.setPeelUI=function(e){console.log("Post User Type: ",e),"peel"===e?$("#postSection").css("padding-top","54px"):"email"===e?$("#postSection").css("padding-top","54px"):"MI16"===e||$("#postSection").css("padding-top","0px")},p.isPeelUser()?(e.isPeelUser=!0,g.hidePeelSplash=!0,e.setPeelUI("peel")):p.isSmartStadiumUser()?(e.isSmartStadiumUser=!0,e.setPeelUI("email")):p.isMI16User()&&(e.isMI16User=!0),e.requestReplies=function(){s.send(d.getRepliesRequest(e.postID));var t=m.getCommentById(e.postID);void 0!=t?A(t):(console.log("No data from comment service : TODO handle this with cookies"),s.send(m.getCommentByIdRequest(e.postID)))},e.peelClose=function(){console.log("peelClose()")},e.peelWatchOnTV=function(){ga("send","event","Peel","click","PeelWatchOnTV"),console.log("peelWatchOnTV()");var e=u.getPeelShowId();void 0!=e?window.location="peel://tunein/"+e:window.location="peel://home"},e.showNewRepliesIndicator=!1,e.newRepliesIndicatorTapped=function(){console.log("newRepliesIndicatorTapped"),e.showNewRepliesIndicator=!1,R(),window.scrollTo(0,document.body.scrollHeight)},e.checkDirectReply=function(){c.directComment&&($("#postCommentField").focus(),c.directComment=!1)},e.triggerRepliesKeyboard=function(){$("#postCommentField").focus()},e.secureLink=function(e,t){return p.isGuestUser()?"":e+t},e.initReplyPage=function(){e.pageClass="page-post",e.paddingTop="20",e.requestReplies();$("#replyPost").height();e.mobileBrowser===!0&&(document.getElementById("postSection").style.paddingBottom="42px"),e.$watch("replies",function(e,t){o(function(){var t=document.getElementsByClassName("postRow");for(div in t)if(void 0!=e){var o=e[div];if(void 0!=o){var i=t[div];i.onclick=function(e){return $(e.target).is("a")?(console.log("EXTERNAL LINK: ",e,this.id),void v.setToLocalStorage("replyBookmark",this.id)):void 0}}}$(".commentsContainer").each(function(){$(".image-link").magnificPopup({type:"image"})})})})},p.isUserLoggedIn()?(s.isSocketConnected()||s.init(),e.initReplyPage()):HTML5_LOC?r.path("/login"):n.location="#/login",e.updateLikeComment=function(e){m.isCommentLiked(e)?s.send(m.getUnlikeCommentRequest(e)):s.send(m.getLikeCommentRequest(e))},e.updateLikeReply=function(e){d.isReplyLiked(e)?s.send(d.unlikeReplyRequest(e)):s.send(d.likeReplyRequest(e))},e.deleteReply=function(e){console.log("deleteReply("+e+")"),s.send(d.deleteReplyRequest(e))},e.reportReplyAsSpam=function(e){console.log("reportReplyAsSpam("+e+")"),s.send(d.flagReplyRequest(e))},e.deleteComment=function(t){console.log("deleteComment("+t+")"),s.send(m.deleteCommentRequest(t)),HTML5_LOC?r.path("/topic/"+e.topicId):n.location="#/topic/"+e.topicId,n.location.reload()},e.reportCommentAsSpam=function(e){console.log("reportCommentAsSpam("+e+")"),s.send(m.flagCommentRequest(e))},e.imageClick=function(e){event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation(),$.magnificPopup.open({items:{type:"image",src:e},type:"inline",callbacks:{open:function(){console.log("popup opened"),$("body").bind("touchmove",function(e){e.preventDefault()})},close:function(){console.log("popup closed"),$("body").unbind("touchmove")}}})};var S=function(){if(void 0==e.replies)R();else{var t=d.replies(),o=t.length;e.replies.length<o?p.isCurrentUser(t[o-1].author.id)?R():e.showNewRepliesIndicator=!0:R()}};d.registerObserverCallback(S),c.registerObserverCallback(b),m.registerObserverCallback(A),e.trustSrc=function(e){return t.trustAsResourceUrl(e)},n.addEventListener("beforeunload",function(){console.log("Before Unload"),v.setToLocalStorage("hasUserVisited",!0)}),e.xLinkActivated=!1}]),angular.module("SocialModule",["NetworkModule","ChannelModule","TopicModule"]).controller("SocialController",["$scope","$sce","$window","$routeParams","$http","SocialService","VideoService","networkService","ChannelService","TopicService","DateUtilityService","CommentService",function(e,t,o,i,n,r,a,l,s,d,c,m){function p(e){var t,o,i;"social"===e?(t=r.socialArray(),h.socialArray=h.socialArray||[],o=h.socialArray.length,i=h.socialArray):(t=a.videoArray(),h.videoArray=h.videoArray||[],o=h.videoArray.length,i=h.videoArray);var n=t.length;if(t&&n>0)for(var l=0;n>l;l++){for(var s=t[l],d=!1,c=0;o>c;c++)s.id===i[c].id&&(d=!0);d||(s.postAuthorName=t[l].embedAuthor.name,s.postAuthorAlias=t[l].embedAuthor.alias,s.postAuthorPhoto=t[l].embedAuthor.photo,s.tweetId=t[l].tweet.id,s.postTimestamp=t[l].createdAt,s.providerName=t[l].embedProvider.name,s.html=t[l].embedText,s.retweetCount=t[l].tweet.metrics.retweetCount,s.likeCount=t[l].tweet.metrics.likeCount,s.replyCount=t[l].tweet.metrics.replyCount,s.embed=t[l].embed,s.embed.embedCreatedAt=t[l].embedCreatedAt,"Twitter"===s.providerName?(s.providerLogo="img/twitterLogo@2x.png",s.embed.provider.logo="img/twitterLogo@2x.png"):(s.providerLogo=t[l].embedProvider.logo,s.embed.provider.logo=t[l].embedProvider.logo),s.embedType=t[l].embedType,s.embedUrl=t[l].embedUrl,"link"===t[l].embedType&&t[l].embedPlayable===!0&&(s.embedHtml=t[l].embedHtml,s.embedPlayable=!0),("media"===t[l].embedType||"link"===t[l].embedType)&&(s.mediaType=t[l].embedMedia.mediaType,s.mediaUrl=t[l].embedMedia.mediaUrl,s.mediaThumbUrl=t[l].embedMedia.mediaThumbUrl,s.mediaAspectRatio=t[l].embedMedia.mediaAspectRatio,s.mediaAspectFeed=t[l].embedMedia.mediaAspectFeed,s.mediaAspectFull=t[l].embedMedia.mediaAspectFull,s.mediaOrientation=t[l].embedMedia.mediaOrientation),"social"===e?h.socialArray.push(s):h.videoArray.push(s),NETWORK_DEBUG&&l===n-1&&("social"===e?console.log("Social Array: ",h.socialArray):console.log("Video Array: ",h.videoArray)))}}function u(e){if("social"===e)for(var t=0;t<h.socialArray.length;t++)h.socialArray[t].postTimestamp=c.getTimeSince(h.socialArray[t].createdAtFull);else for(var t=0;t<h.videoArray.length;t++)h.videoArray[t].postTimestamp=c.getTimeSince(h.videoArray[t].createdAtFull)}function g(e,t,o){var i;return function(){var n=this,r=arguments,a=function(){i=null,o||e.apply(n,r)},l=o&&!i;clearTimeout(i),i=setTimeout(a,t),l&&e.apply(n,r)}}console.log("Social Control");var h=this;this.initFeed=function(t){"social"===t?(h.socialArray||(e.$parent.loadingSocial=!0),h.socialArray&&u("social"),e.$parent.switchTabs("social"),r.resetSocialOffset(),h.loadContent("social")):(h.videoArray||(e.$parent.loadingSocial=!0),h.videoArray&&u("video"),e.$parent.switchTabs("video"),a.resetVideoOffset(),h.loadContent("video"))},this.loadContent=function(e,t){var o=s.getChannel()||d.getChannelId();"social"===e?(console.log("LOADING SOCIAL: ",o),l.send(r.getSocialDataRequest(o,t))):(console.log("LOADING VIDEO: ",o),l.send(a.getVideoDataRequest(o,t)))},r.registerObserverCallback(function(){p("social")}),a.registerObserverCallback(function(){p("video")});var f=document.documentElement.clientHeight||window.innerHeight,v=g(function(){var t=$(document).height()-f-50;$(document).scrollTop()>t&&t>500&&("social"===e.activeTab?h.loadContent("social",h.socialArray.length):"video"===e.activeTab&&h.loadContent("video",h.videoArray.length))},100);$(document).on("scroll",v),this.retweetPost=function(e){n({method:"GET",url:"https://twitter.com/intent/retweet?tweet_id="+e,headers:{"Access-Control-Allow-Origin":"*"}})},this.shareTweetToChat=function(t){if(h.embedShareContent=t,h.showShareDialog=!0,console.log("Embed Object: ",t),e.$parent.isPeelUser){var o=document.documentElement.clientHeight-54;console.log("fullClient Height: ",o),setTimeout(function(){$("#sharePreviewContainer").css({top:"54px"}).height(o)},25)}},this.submitSharedPost=function(t,o){var i=e.$parent.topicID;console.log("topicID From Parent: ",i),l.send(m.postCommentRequestForShare(i,t,o)),h.showShareDialog=!1,e.$parent.switchTabs("chat")},console.log("WAY BEFOREEEE"),void 0===FB&&!function(e,t,o){console.log("loading FB SDK...");var i,n=e.getElementsByTagName(t)[0];e.getElementById(o)||(i=e.createElement(t),i.id=o,i.src="//connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(i,n))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){console.log("BEFOREEEE"),FB.init({appId:"210324962465861",xfbml:!0,version:"v2.4"}),console.log("AFTERRRRR")},this.shareToFacebook=function(e,t){FB.ui({method:"share",href:t},function(e){console.log("FB Response Post-Share: ",e)})},this.exitShare=function(){h.showShareDialog=!1},this.highlightPost=function(){$("#postShareContent").css("color","rgb(22,189,231)")},this.unhighlightPost=function(){$("#postShareContent").css("color","rgb(211,214,215)")}}]),angular.module("SmartStadiumModule",[]).controller("SmartStadiumController",["$scope",function(e){var t=this;this.viewScreen=!1,this.ssActiveScreen,this.viewHighlights=function(){t.ssActiveScreen="highlights",t.viewScreen=!0},this.viewRoster=function(){t.ssActiveScreen="roster",t.viewScreen=!0},this.viewStats=function(){t.ssActiveScreen="stats",t.viewScreen=!0},this.viewProfileStats=function(){t.ssActiveScreen="profileStats",t.viewScreen=!0},this.exitView=function(){t.viewScreen=!1}}]),angular.module("SocialModule").directive("shareToChatDialog",function(){return{restrict:"E",scope:{thisPost:"=",trustSource:"&",shareSubmit:"&",exitShare:"&",highlight:"&",unhighlight:"&"},templateUrl:"partials/sharePreview.html"}}),angular.module("PostModule").directive("ngElementReady",[function(){return{priority:-1e3,restrict:"A",link:function(e,t,o){e.$eval(o.ngElementReady)}}}]),angular.module("NetworkModule").factory("ReplyService",["DateUtilityService","Bant","FDSUtility",function(e,t,o){function n(e){if(M=[],tempReplyData=e.data.results,void 0!=tempReplyData&&tempReplyData.length>0){var o=tempReplyData.length;for(i=0;i<o;i++){var n={};n=t.bant(tempReplyData[i]),void 0!=n.id&&M.push(n),C=tempReplyData[i].topicId}$()}}function r(e){var o=e.data;if(void 0!=o&&(console.log("appendToReplies :"+o),console.log("Reply comment ID :"+o.commentId),console.log("Current comment ID :"+w),o.commentId==w)){var i=t.bant(o);void 0!=i.id&&M.push(i),$()}}function a(e){var o=e.data;for(i=0;i<M.length;i++)if(M[i].id==o.id)return M[i]=t.bant(o),console.log("Reply updated"),1;return r(e),0}function l(e){for(i=0;i<M.length;i++)if(M[i].id==e.id)return M[i]=e,void(NETWORK_DEBUG&&console.log("updated Data for id:"+M[i].id))}function s(e,o){if(NETWORK_DEBUG&&console.log("updateLikeReplyWithId :"+e+"   liked "+o),void 0!=e){var i;i=c(e),i=t.updateBantLiked(i,o),l(i),$()}}function d(e){for(i=0;i<M.length;i++)M[i].id==e.id&&M.splice(i,1)}function c(e){for(NETWORK_DEBUG&&console.log("_replies :"+M.length),i=0;i<M.length;i++)if(M[i].id==e)return M[i]}function m(e){for(NETWORK_DEBUG&&console.log("_replies :"+M.length),i=0;i<M.length;i++)if(M[i].id==e)return M[i].commentId}function p(e){return varReplyParams={rid:"reply",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(e)}}function u(e){return varPostParams={rid:"reply",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(e)}}function g(e){w=e;var t=I+e;return p(t)}function h(e,t,o,i,n){var r="comment",a=t;void 0!=n&&1==n&&(r="reply",a=i),console.log("Topicid : "+e,"commentid : "+t,"replydata : "+o);var l=u(k);return l.data={lang:"en",content:{sections:[{type:"html",html:o}]},target:{type:r,id:a},topicId:e,commentId:t},l}function f(e){return u(D+e)}function v(e){return u(P+e)}function y(e){return u(O+e+"?reason=spam")}function b(e){return u(U+e)}function A(e){for(var t=L.length;t>0;)t=L.length,L.pop();L.push(e)}function R(e){return o.isLikedById(M,e)}function S(e,t){if(e==D+t)console.log("calling update like "),s(t,!0);else if(e==P+t)s(t,!1);else{if(e==U+t)return M=o.deleteById(M,t),$(),0;e==O+t?M=o.flagById(M,!0):e==B+t?M=o.flagById(M,!1):e==E+t?M=o.hideById(M,!0):e==F+t&&(M=o.hideById(M,!1))}}var T,C,w,I="/v1.0/comment/replies/list/",k="/v1.0/reply/create",U="/v1.0/reply/delete/",D="/v1.0/reply/like/",P="/v1.0/reply/unlike/",E="/v1.0/reply/hide/",F="/v1.0/reply/unhide/",O="/v1.0/reply/flag/",B="/v1.0/reply/unflag/",L=[],M=[],$=function(){angular.forEach(L,function(e){e()})};return{replies:function(){return M},getTopicIdFromReply:function(){return C},getPostId:function(){return T},setPostId:function(e){T=e},setReplies:n,updateReply:a,appendToReplies:r,updateLikeReplyWithId:s,updateReplyLocalData:S,removeReply:d,getPostReplyRequest:h,likeReplyRequest:f,unlikeReplyRequest:v,deleteReplyRequest:b,flagReplyRequest:y,registerObserverCallback:A,getRepliesRequest:g,isReplyLiked:R,getCommentIdByReply:m}}]),angular.module("SocialModule").factory("SocialService",["Bant",function(e){function t(t){l=[];var o=t.data.results,n=o.length;if(o&&n>0){for(i=0;i<n;i++){var r=e.bant(o[i]);r.id&&l.push(r)}s=t.data.nextOffset,c()}}function o(e){for(var t=a.length;t>0;)t=a.length,a.pop();a.push(e)}function n(e,t){var o=t||s,i={rid:"social",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(r+e+"?limit="+d+"&offset="+o)};return console.log("Social Request: ",i),i}var r="/v1.0/channel/social/list/",a=[],l=[],s=0,d=20,c=function(){angular.forEach(a,function(e){e()})};return{socialArray:function(){return l},resetSocialOffset:function(){s=0},setSocialData:t,getSocialDataRequest:n,registerObserverCallback:o}}]),angular.module("SocialModule").factory("VideoService",["Bant",function(e){function t(t){l=[];var o=t.data.results,n=o.length;if(o&&n>0){for(i=0;i<n;i++){var r=e.bant(o[i]);r.id&&l.push(r)}s=t.data.nextOffset,c()}}function o(e){for(var t=a.length;t>0;)t=a.length,a.pop();a.push(e)}function n(e,t){var o=t||s,i={rid:"video",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(r+e+"?limit="+d+"&offset="+o+"&filter=video")};return console.log("Video Request: ",i),i}var r="/v1.0/channel/social/list/",a=[],l=[],s=0,d=10,c=function(){angular.forEach(a,function(e){e()})};return{videoArray:function(){return l},resetVideoOffset:function(){s=0},setVideoData:t,getVideoDataRequest:n,registerObserverCallback:o}}]);
//# sourceMappingURL=app-post.min.js.map
