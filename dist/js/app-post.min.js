angular.module("PostModule",["NetworkModule","SplashModule","MediaModule","angularFileUpload"]).controller("PostController",["$scope","$sce","$timeout","$window","$location","$sanitize","$routeParams","networkService","ReplyService","TopicService","CommentService","UserInfoService","URIHelper","SplashService","MUService","FileUploader","ForumStorage","UserAgentService",function(e,t,o,n,l,r,a,d,s,m,c,p,u,g,f,h,b,v){function y(){e.leftTeam=m.getTeamA(),e.rightTeam=m.getTeamB();var t=m.getScore();void 0!=t&&(e.leftTeamScore=t.points[0],e.rightTeamScore=t.points[1]),e.gameStatus=m.getGameStatus(),e.topicTitle=m.getTitle(),"live"==e.gameStatus&&(e.gamePeriod=m.getGamePeriod(),e.gameClock=m.getGameClock()),console.log("Scores updated in replies")}function R(t){if(console.log("Already Had PostID: ",e.postID),e.postID||(e.postID=s.getPostId(),console.log("Regenerated PostID: ",e.postID)),void 0==t&&(t=c.getCommentById(e.postID)),void 0!=t){NETWORK_DEBUG&&console.log("Updated comment in reply triggered");var i={};i=t,i.postAuthorName=t.author.name,i.postAuthorPhoto=t.author.photo,i.postTimestamp=t.createdAt,i.likeCount=t.metrics.likes,i.replyCount=t.metrics.replies,i.mediaAspectFeed=t.mediaAspectFeed,i.isLiked=t.signal.like,i.topicId=t.topicId,i.isMyComment=p.isCurrentUser(t.author.id),"media"===i.type&&(i.mediaUrl=t.mediaUrl,i.mediaAspectFeed=t.mediaAspectFeed,i.mediaAspectFull=t.mediaAspectFull,i.mediaAspectRatio=t.mediaAspectRatio,i.mediaOrientation=t.mediaOrientation,i.mediaThumbUrl=t.mediaThumbUrl),"embed"===i.type&&(i.shared=!0,i.embed=t.embed,i.embed.embedCreatedAt=t.embedCreatedAt,i.embed.embedCreatedAtFull=t.embedCreatedAtFull,"media"===i.embedType&&(i.mediaUrl=t.embedMedia.mediaUrl,i.mediaThumbUrl=t.embedMedia.mediaThumbUrl,i.mediaAspectFeed=t.embedMedia.mediaAspectFeed,i.mediaAspectFull=t.embedMedia.mediaAspectFull,i.mediaAspectRatio=t.embedMedia.mediaAspectRatio,i.mediaOrientation=t.embedMedia.mediaOrientation),"Twitter"===i.providerName?i.embed.embedLogo="img/twitterLogo@2x.png":i.embed.embedLogo=t.embed.provider.logo,"link"===t.embed.type&&t.embed.playable===!0&&(i.embedHtml=t.embedHtml)),e.comment=i}}function S(){var o=s.replies(),n=o.length;for(e.replies=[],i=0;i<n;i++){var l={};l=o[i],l.postAuthorName=o[i].author.name,l.postAuthorPhoto=o[i].author.photo,l.isMyReply=p.isCurrentUser(o[i].author.id),l.postTimestamp=o[i].createdAt,l.likeCount=o[i].metrics.likes,l.replyCount=o[i].metrics.replies,l.mediaAspectFeed=o[i].mediaAspectFeed,l.isLiked=o[i].signal.like,"media"===l.type&&(l.mediaUrl=o[i].mediaUrl,l.mediaAspectFeed=o[i].mediaAspectFeed,l.mediaAspectFull=o[i].mediaAspectFull,l.mediaAspectRatio=o[i].mediaAspectRatio,l.mediaOrientation=o[i].mediaOrientation,l.mediaThumbUrl=o[i].mediaThumbUrl),"embed"===l.type&&(l.shared=!0,l.embed=o[i].embed,l.embed.embedCreatedAt=o[i].embedCreatedAt,l.embed.embedCreatedAtFull=o[i].embedCreatedAtFull,"Twitter"===l.providerName?l.embed.embedLogo="img/twitterLogo@2x.png":l.embed.embedLogo=o[i].embed.provider.logo,"link"===o[i].embed.type&&o[i].embed.playable===!0&&(l.embed.embedHtml=t.trustAsHtml(o[i].embedHtml))),e.replies.push(l),"media"==e.replies[i].type}1==e.justReplied&&setTimeout(function(){console.log("Scroll to last reply"),window.scrollTo(0,document.body.scrollHeight),e.justReplied=!1},1e3)}v.isMobileUser()?(e.mobileBrowser=!0,e.mobileUserAgent=v.getMobileUserAgent(),console.log("MOBILE USER AGENT: ",e.mobileUserAgent)):e.mobileBrowser=!1,b.getFromLocalStorage("hasUserVisited")===!0&&(console.log("Checking For Existing Session"),e.initPage());e.pageClass="page-post",e.postID=a.postID,e.topicId=m.getTopicId(),e.justReplied=!1,s.setPostId(a.postID),e.backToTopicButtonTapped=function(){var t=m.getTopicId();if(-1!==window.location.href.indexOf("?"))var i=window.location.href.slice(window.location.href.indexOf("?"));void 0==t&&(t=e.comment.topicId),void 0!==i?l.url("/topic/"+t+i):l.url("/topic/"+t)},e.setPeelUI=function(e){console.log("Post User Type: ",e),"peel"===e?($("#postSection").css("padding-top","104px"),$("#backToChatContainer").css("margin-top","54px")):"email"===e?$("#postSection").css("padding-top","104px"):"MI16"===e||$("#postSection").css("padding-top","50px")},p.isPeelUser()?(e.isPeelUser=!0,g.hidePeelSplash=!0,e.setPeelUI("peel")):p.isSmartStadiumUser()?(e.isSmartStadiumUser=!0,e.setPeelUI("email")):p.isMI16User()||p.isMWCUser()?(e.techMUser=!0,e.setPeelUI()):(e.techMUser=!1,e.setPeelUI()),e.requestReplies=function(){d.send(s.getRepliesRequest(e.postID));var t=c.getCommentById(e.postID);void 0!=t?R(t):(console.log("No data from comment service : TODO handle this with cookies"),d.send(c.getCommentByIdRequest(e.postID)))},e.peelClose=function(){console.log("peelClose()")},e.peelWatchOnTV=function(){ga("send","event","Peel","click","PeelWatchOnTV"),console.log("peelWatchOnTV()");var e=u.getPeelShowId();void 0!=e?window.location="peel://tunein/"+e:window.location="peel://home"},e.showNewRepliesIndicator=!1,e.newRepliesIndicatorTapped=function(){console.log("newRepliesIndicatorTapped"),e.showNewRepliesIndicator=!1,S(),window.scrollTo(0,document.body.scrollHeight)},e.checkDirectReply=function(){console.log("Checking for Direct Reply ",m.directComment),m.directComment&&($("#commentField").focus(),m.directComment=!1)},e.triggerRepliesKeyboard=function(){$("#commentField").focus()},e.secureLink=function(e,t){return p.isGuestUser()?"":e+t},e.initReplyPage=function(){e.pageClass="page-post",e.paddingTop="20",e.requestReplies();$("#replyPost").height();e.mobileBrowser===!0&&(document.getElementById("postSection").style.paddingBottom="42px"),e.$watch("replies",function(e,t){o(function(){var t=document.getElementsByClassName("postRow");for(div in t)if(void 0!=e){var i=e[div];if(void 0!=i){var o=t[div];o.onclick=function(e){return $(e.target).is("a")?(console.log("EXTERNAL LINK: ",e,this.id),void b.setToLocalStorage("replyBookmark",this.id)):void 0}}}$("#commentsContainer").each(function(){$(".image-link").magnificPopup({type:"image"})})})})},p.isUserLoggedIn()?(d.isSocketConnected()||d.init(),e.initReplyPage()):l.url("/login"),e.updateLikeComment=function(e){c.isCommentLiked(e)?d.send(c.getUnlikeCommentRequest(e)):d.send(c.getLikeCommentRequest(e))},e.updateLikeReply=function(e){s.isReplyLiked(e)?d.send(s.unlikeReplyRequest(e)):d.send(s.likeReplyRequest(e))},e.deleteReply=function(e){console.log("deleteReply("+e+")"),d.send(s.deleteReplyRequest(e))},e.reportReplyAsSpam=function(e){console.log("reportReplyAsSpam("+e+")"),d.send(s.flagReplyRequest(e))},e.deleteComment=function(t){console.log("deleteComment("+t+")"),d.send(c.deleteCommentRequest(t)),l.url("/topic/"+e.topicId),n.location.reload()},e.reportCommentAsSpam=function(e){console.log("reportCommentAsSpam("+e+")"),d.send(c.flagCommentRequest(e))},e.imageClick=function(e){event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation(),$.magnificPopup.open({items:{type:"image",src:e},type:"inline",callbacks:{open:function(){console.log("popup opened"),$("body").bind("touchmove",function(e){e.preventDefault()})},close:function(){console.log("popup closed"),$("body").unbind("touchmove")}}})};var A=function(){if(void 0==e.replies)S();else{var t=s.replies(),i=t.length;e.replies.length<i?p.isCurrentUser(t[i-1].author.id)?S():e.showNewRepliesIndicator=!0:S()}};s.registerObserverCallback(A),m.registerObserverCallback(y),c.registerObserverCallback(R,!0),e.trustSrc=function(e){return t.trustAsResourceUrl(e)},n.addEventListener("beforeunload",function(){d.closeSocket(),console.log("Before Unload: Close Socket")}),e.xLinkActivated=!1}]),angular.module("SmartStadiumModule",[]).controller("SmartStadiumController",["$scope",function(e){var t=this;this.viewScreen=!1,this.ssActiveScreen,this.viewHighlights=function(){t.ssActiveScreen="highlights",t.viewScreen=!0},this.viewRoster=function(){t.ssActiveScreen="roster",t.viewScreen=!0},this.viewStats=function(){t.ssActiveScreen="stats",t.viewScreen=!0},this.viewProfileStats=function(){t.ssActiveScreen="profileStats",t.viewScreen=!0},this.exitView=function(){t.viewScreen=!1}}]),angular.module("SocialModule").directive("shareToChatDialog",["URIHelper",function(e){return{restrict:"E",scope:{thisPost:"=",trustSource:"&",shareSubmit:"&",exitShare:"&",highlight:"&",unhighlight:"&"},link:function(t,i,o){e.embedded()&&(t.embed=!0)},templateUrl:"partials/sharePreview.html"}}]),angular.module("NetworkModule").factory("ReplyService",["DateUtilityService","Bant","FDSUtility",function(e,t,o){function n(e){if(E=[],tempReplyData=e.data.results,void 0!=tempReplyData&&tempReplyData.length>0){var o=tempReplyData.length;for(i=0;i<o;i++){var n={};n=t.bant(tempReplyData[i]),void 0!=n.id&&E.push(n),I=tempReplyData[i].topicId}N()}}function l(e){var i=e.data;if(void 0!=i&&(console.log("appendToReplies :"+i),console.log("Reply comment ID :"+i.commentId),console.log("Current comment ID :"+U),i.commentId==U)){var o=t.bant(i);void 0!=o.id&&E.push(o),N()}}function r(e){var o=e.data;for(i=0;i<E.length;i++)if(E[i].id==o.id)return E[i]=t.bant(o),console.log("Reply updated"),1;return l(e),0}function a(e){for(i=0;i<E.length;i++)if(E[i].id==e.id)return E[i]=e,void(NETWORK_DEBUG&&console.log("updated Data for id:"+E[i].id))}function d(e,i){if(NETWORK_DEBUG&&console.log("updateLikeReplyWithId :"+e+"   liked "+i),void 0!=e){var o;o=m(e),o=t.updateBantLiked(o,i),a(o),N()}}function s(e){for(i=0;i<E.length;i++)E[i].id==e.id&&E.splice(i,1)}function m(e){for(NETWORK_DEBUG&&console.log("_replies :"+E.length),i=0;i<E.length;i++)if(E[i].id==e)return E[i]}function c(e){for(NETWORK_DEBUG&&console.log("_replies :"+E.length),i=0;i<E.length;i++)if(E[i].id==e)return E[i].commentId}function p(e){return varReplyParams={rid:"reply",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(e)}}function u(e){return varPostParams={rid:"reply",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(e)}}function g(e){U=e;var t=C+e;return p(t)}function f(e,t,i,o,n){var l="comment",r=t;void 0!=n&&1==n&&(l="reply",r=o),console.log("Topicid : "+e,"commentid : "+t,"replydata : "+i);var a=u(w);return a.data={lang:"en",content:{sections:[{type:"html",html:i}]},target:{type:l,id:r},topicId:e,commentId:t},a}function h(e){return u(P+e)}function b(e){return u(D+e)}function v(e){return u(B+e+"?reason=spam")}function y(e){return u(k+e)}function R(e){for(var t=O.length;t>0;)t=O.length,O.pop();O.push(e)}function S(e){return o.isLikedById(E,e)}function A(e,t){if(e==P+t)console.log("calling update like "),d(t,!0);else if(e==D+t)d(t,!1);else{if(e==k+t)return E=o.deleteById(E,t),N(),0;e==B+t?E=o.flagById(E,!0):e==L+t?E=o.flagById(E,!1):e==F+t?E=o.hideById(E,!0):e==M+t&&(E=o.hideById(E,!1))}}var T,I,U,C="/v1.0/comment/replies/list/",w="/v1.0/reply/create",k="/v1.0/reply/delete/",P="/v1.0/reply/like/",D="/v1.0/reply/unlike/",F="/v1.0/reply/hide/",M="/v1.0/reply/unhide/",B="/v1.0/reply/flag/",L="/v1.0/reply/unflag/",O=[],E=[],N=function(){angular.forEach(O,function(e){e()})};return{replies:function(){return E},getTopicIdFromReply:function(){return I},getPostId:function(){return T},setPostId:function(e){T=e},setReplies:n,updateReply:r,appendToReplies:l,updateLikeReplyWithId:d,updateReplyLocalData:A,removeReply:s,getPostReplyRequest:f,likeReplyRequest:h,unlikeReplyRequest:b,deleteReplyRequest:y,flagReplyRequest:v,registerObserverCallback:R,getRepliesRequest:g,isReplyLiked:S,getCommentIdByReply:c}}]),angular.module("SocialModule").factory("SocialService",["Bant",function(e){function t(t){m=[];var o=t.data.results,n=o.length;if(o&&n>0){for(i=0;i<n;i++){var l=e.bant(o[i]);if(l.id){var r=!0;for(i=0;i<m.length;i++)if(m[i].id==l.id){r=!1;break}r&&m.push(l)}}c=t.data.nextOffset,console.log("Social Array offset : "+c),"social"===t.rid?u():u(!0)}}function o(e){for(var t=s.length;t>0;)t=s.length,s.pop();s.push(e);for(var t=d.length;t>0;)t=d.length,d.pop();d.push(e)}function n(e,t){var i=c,o={rid:"social",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(a+e+"?limit="+p+"&offset="+i)};return NETWORK_DEBUG&&console.log("Social Request: ",o),o}function l(e){var t={rid:"social_auto",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(a+e+"?limit="+p+"&offset=0")};return NETWORK_DEBUG&&console.log("Social Request Auto: ",t),t}function r(e,t){return e.postAuthorName=t.embedAuthor.name,e.postAuthorAlias=t.embedAuthor.alias,e.postAuthorPhoto=t.embedAuthor.photo,e.tweetId=t.tweet.id,e.postTimestamp=t.createdAt,e.providerName=t.embedProvider.name,e.html=t.embedText,e.retweetCount=t.tweet.metrics.retweetCount,e.likeCount=t.tweet.metrics.likeCount,e.replyCount=t.tweet.metrics.replyCount,e.embed=t.embed,e.embed.embedCreatedAt=t.embedCreatedAt,"Twitter"===e.providerName?(e.providerLogo="img/twitterLogo@2x.png",e.embed.provider.logo="img/twitterLogo@2x.png"):(e.providerLogo=t.embedProvider.logo,e.embed.provider.logo=t.embedProvider.logo),e.embedType=t.embedType,e.embedUrl=t.embedUrl,"link"===t.embedType&&t.embedPlayable===!0&&(e.embedHtml=t.embedHtml,e.embedPlayable=!0),("media"===t.embedType||"link"===t.embedType)&&(e.mediaType=t.embedMedia.mediaType,e.mediaUrl=t.embedMedia.mediaUrl,e.mediaThumbUrl=t.embedMedia.mediaThumbUrl,e.mediaAspectRatio=t.embedMedia.mediaAspectRatio,e.mediaAspectFeed=t.embedMedia.mediaAspectFeed,e.mediaAspectFull=t.embedMedia.mediaAspectFull,e.mediaOrientation=t.embedMedia.mediaOrientation),e}var a="/v1.0/channel/social/list/",d=[],s=[],m=[],c=0,p=20,u=function(e){e?angular.forEach(s,function(e){console.log("Notify observer in autoRequest"),e()}):angular.forEach(d,function(e){e()})};return{socialArray:function(){return m},resetSocialOffset:function(){c=0},setSocialData:t,getSocialDataRequest:n,getSocialDataRequestAuto:l,registerObserverCallback:o,formatSocial:r}}]);
//# sourceMappingURL=app-post.min.js.map
