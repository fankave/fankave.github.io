angular.module("Forum",["ngRoute","ngSanitize","ng.deviceDetector","AuthModule","ChannelModule","TopicModule","PostModule","NetworkModule","MediaModule","SocialModule","UserInput","SmartStadiumModule"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/login",{templateUrl:"partials/facebookLogin.html",controller:"AuthController"}).when("/channel/:channelID",{templateUrl:"partials/login.html",controller:"ChannelController"}).when("/topic/:topicID",{templateUrl:"partials/topic.html",controller:"TopicController"}).when("/post/:postID",{templateUrl:"partials/post.html",controller:"PostController"}).when("/invalidTopic",{templateUrl:"partials/invalidTopic.html"}).otherwise({redirectTo:"/invalidTopic"}),window.history&&window.history.pushState&&HTML5_LOC&&t.html5Mode({enabled:!0})}]).filter("hashtags",["$filter","$sce",function(e,t){return function(o,n){if(!o)return o;var i=e("linky")(o,n),r="";angular.isDefined(n)&&(r=' target="'+n+'"');var a=/(^|\s)#(\w*[a-zA-Z_]+\w*)/gim;i=o.replace(a,'$1<a href="https://twitter.com/search?q=%23$2"'+r+">#$2</a>");var s=/(^|\s)\@(\w*[a-zA-Z_]+\w*)/gim;return i=i.replace(s,'$1<a href="https://twitter.com/$2"'+r+">@$2</a>"),t.trustAsHtml(i),i}}]),angular.module("Forum").directive("ngElementReady",[function(){return{priority:-1e3,restrict:"A",link:function(e,t,o){e.$eval(o.ngElementReady)}}}]),angular.module("Forum").directive("reportPageHeight",["URIHelper",function(e){return{link:function(t,o,n){function i(e){GEN_DEBUG&&console.log("Sending Height: ",e,parent);var t={type:"resize",contentHeight:e};parent.postMessage(t,"http://www.collegespun.com"),parent.postMessage(t,"http://www.fankave.net")}e.embedded()&&(t.$watch(function(){t.__height=o.height()}),t.$watch("__height",function(e,t){i(e)}))}}}]),angular.module("ChannelModule",["NetworkModule","AuthModule"]).controller("ChannelController",["$scope","$window","$location","$sce","$routeParams","networkService","ChannelService","TopicService","URIHelper","AuthService","UserInfoService",function(e,t,o,n,i,r,a,s,c,l,d){function u(){r.init(),r.send(a.getLiveGameTopic())}if(a.setChannel(i.channelID),-1!==window.location.href.indexOf("?")){var m=window.location.href.slice(window.location.href.indexOf("?")+1);GEN_DEBUG&&console.log("urlQueryStr: "+m)}var p=function(){var e=a.getLiveTopicId();void 0!==e&&(GOOGLE_ANALYTICS===!0&&ga("send","pageview","/topic/"+e),GEN_DEBUG&&(console.log("Sent Pageview from /channel/"+e),console.log("Got Topic id from Channel : /topic/"+e+m)),m?o.url("/topic/"+e+"?"+m):o.url("/topic/"+e))};a.registerObserverCallback(p),d.isUserLoggedIn()?(NETWORK_DEBUG&&console.log("User is logged in, checking for connection"),u()):c.isSmartStadiumUser()?l.loginWithEmail():c.isTechMUser()?(GEN_DEBUG&&console.log("MI16 User Detected"),o.url("/login?MI16=true")):c.isMWCUser()?(GEN_DEBUG&&console.log("MWC User Detected"),o.url("/login?MWC=true")):c.isPeelUser()?l.loginWithPeel():l.loginAsGuest()}]),angular.module("AuthModule",["NetworkModule","TopicModule"]).controller("AuthController",["$scope","$routeParams","$http","AuthService","UserInfoService","TopicService","ReplyService","networkService","ForumDeviceInfo","ChannelService","URIHelper",function(e,t,o,n,i,r,a,s,c,l,d){function u(){e.showFacebookButton=!1}if(d.embedded()&&$("#fankave-page").height(700),-1!==window.location.href.indexOf("?")){var m=window.location.href.slice(window.location.href.indexOf("?")+1);GEN_DEBUG&&console.log("urlQueryStr: ",m),d.isTechMUser()&&(e.mUserType="MI16"),d.isMWCUser()&&(e.mUserType="MWC")}else e.facebookUser=!0;e.facebookUser?(!function(e,t,o){var n,i=e.getElementsByTagName(t)[0];e.getElementById(o)||(n=e.createElement(t),n.id=o,n.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(n,i))}(document,"script","facebook-jssdk"),GOOGLE_ANALYTICS===!0&&ga("send","pageview","Facebook Landing")):GOOGLE_ANALYTICS===!0&&ga("send","pageview","Tech MI16 Landing"),e.showFacebookButton=!0,e.loginToFacebook=function(){n.loginToFacebook(u)},e.techMLogin=function(t,o,i){i&&n.techMLogin(t,o,e.mUserType),e.submitted=!0},window.fbAsyncInit=function(){FB.init({appId:"210324962465861",xfbml:!0,version:"v2.4"}),FB.getLoginStatus(function(t){if("connected"===t.status){e.showFacebookButton=!1;var o=n.setRegistrationParams("facebook",-25200,t.authResponse);n.registerUser(o)}else"not_authorized"===t.status?(e.showFacebookButton=!1,e.loginToFacebook()):e.showFacebookButton=!0})},e.focusMWC=function(){$("#techLoginContainer").animate({top:"-40px"},100)},e.blurMWC=function(){$("#techLoginContainer").animate({top:""},100)}}]),angular.module("TopicModule",["NetworkModule","SplashModule","AuthModule","MediaModule","angularFileUpload","SocialModule"]).controller("TopicController",["$scope","$rootScope","$sce","$window","$location","$sanitize","$timeout","$interval","$routeParams","networkService","TopicService","CommentService","UserInfoService","URIHelper","AuthService","SplashService","MUService","ForumStorage","FileUploader","SocialService","VideoService","ChannelService","UserAgentService","AnalyticsService","TimerService",function(e,t,o,n,r,a,s,c,l,d,u,m,p,g,f,v,h,T,E,S,U,w,b,y,C){function A(){"livegame"===e.topicType&&(e.isPeelUser&&e.peelShowId?$("#topicSection").css("padding-top","54px"):e.isSmartStadiumUser?$("#topicSection").css("padding-top","54px"):e.isMI16User||$("#topicSection").css("padding-top","0px"))}function I(){if(void 0!==u.getTopic()){if(e.topicType=u.getTopicType(),u.isWatchingTopic()===!1&&(d.send(u.getFollowChannelRequest()),d.send(u.watchTopicRequest(l.topicID))),A(),"livegame"==e.topicType){GEN_DEBUG&&console.log("Inside topic set :"+u.getTeamA()),e.isCricket=u.isGameCricket(),e.isCricket&&!e.$$phase&&e.$apply(),e.leftTeam=u.getTeamA(),e.rightTeam=u.getTeamB();var o=u.getScore();void 0!=o&&(e.leftTeamScore=o.points[0],e.rightTeamScore=o.points[1]),e.gameStatus=u.getGameStatus(),"live"==e.gameStatus&&(e.gamePeriod=u.getGamePeriod(),e.gameClock=u.getGameClock(),e.isCricket&&(e.offenseTeam=u.getOffense().team,e.offensePosition=u.getOffense().position)),"past"===e.gameStatus&&e.isCricket&&(e.gameSummary=u.getGameSummary()),e.gameScheduledTime=u.getGameTime(),e.allScoresTitle=u.getScoresTitle(),e.allScoresURL=u.getScoresLink();var n=$(".scoreCardContent"),i=$(".svg-content");n.css("background-color",e.leftTeam.pColor),i.css("fill",e.rightTeam.pColor)}e.topicTitle=u.getTitle();var r=u.getTopic();e.topicDescHtml=r.html,"media"==r.type&&(e.topicMediaUrl=r.mediaUrl,e.topicMediaAspectFeed=r.mediaAspectFull),e.createdAt=u.getTimeCreatedAt(),e.liked=u.getLiked();var a=u.getMetrics();e.likesCount=a.likes,e.commentsCount=a.comments,e.commentsCount&&0!==e.commentsCount||(e.loadingChat=!1),g.tabEntry()||("video"===g.getActiveTab()?t.$broadcast("videoActive"):"social"===g.getActiveTab()?t.$broadcast("socialActive"):(ANALYTICS&&y.addSession("chat"),g.tabEntered()))}}function D(){var t=m.comments();if(void 0!=t&&(t.length>0||R===!0)){R=!1;var o=t.length;for(e.commentsArray=[],i=0;i<o;i++){var n={};n=t[i],n.postAuthorName=t[i].author.name,n.postAuthorPhoto=t[i].author.photo,n.isMyComment=p.isCurrentUser(t[i].author.id),n.likeCount=t[i].metrics.likes,n.replyCount=t[i].metrics.replies,n.postTimestamp=t[i].createdAt,"media"===n.type&&(n.mediaUrl=t[i].mediaUrl,n.mediaAspectFeed=t[i].mediaAspectFeed,n.mediaAspectFull=t[i].mediaAspectFull,n.mediaAspectRatio=t[i].mediaAspectRatio,n.mediaOrientation=t[i].mediaOrientation,n.mediaThumbUrl=t[i].mediaThumbUrl),n.isLiked=t[i].signal.like,"embed"===n.type&&(n.shared=!0,n.embed=t[i].embed,n.embed.embedCreatedAt=t[i].embedCreatedAt,n.embed.embedCreatedAtFull=t[i].embedCreatedAtFull,n.embedType=t[i].embedType,"media"!==n.embedType&&"link"!==n.embedType||(n.mediaUrl=t[i].embedMedia.mediaUrl,n.mediaThumbUrl=t[i].embedMedia.mediaThumbUrl,n.mediaAspectFeed=t[i].embedMedia.mediaAspectFeed,n.mediaAspectFull=t[i].embedMedia.mediaAspectFull,n.mediaAspectRatio=t[i].embedMedia.mediaAspectRatio,n.mediaOrientation=t[i].embedMedia.mediaOrientation),"Twitter"===n.providerName?n.embed.embedLogo="img/twitterLogo@2x.png":n.embed.embedLogo=t[i].embed.provider.logo,"link"===t[i].embed.type&&t[i].embed.playable===!0&&(n.embedHtml=t[i].embedHtml)),e.commentsArray.push(n),i===o-1&&NETWORK_DEBUG&&console.log("Comments Array: ",e.commentsArray)}}}function G(){GEN_DEBUG&&console.log("LOADING REST OF COMMENTS..."),m.loadedComments()||(d.send(m.getCommentsRequest(l.topicID)),m.setLoadedComments(!0),e.loadedAllComments=!0)}function k(){d.send(u.getTopicRequest(l.topicID)),"chat"===e.activeTab&&d.send(m.getCommentsRequest(l.topicID))}function N(){u.fromPost()&&(e.activeTab="chat",u.toggleFromPost(),C.setLastActiveTab("chat")),I(),D(),e.pageClass="page-topic",e.showNewCommentsIndicator=!1,e.topicID=l.topicID,k(),e.mobileBrowser!==!0||g.embedded()||(document.getElementById("topicSection").style.paddingBottom="42px")}function O(e,t,o){var n;return function(){var i=this,r=arguments,a=function(){n=null,o||e.apply(i,r)},s=o&&!n;clearTimeout(n),n=setTimeout(a,t),s&&e.apply(i,r)}}var B=C.globalTime();C.globalTimerStarted()||C.initTimer();var R=!1,M=g.getActiveTab();"social"===M?t.leftTab="social":"video"===M?t.leftTab="video":(t.leftTab="chat",e.activeTab="chat",C.setLastActiveTab("chat")),b.isMobileUser()?(e.mobileBrowser=!0,e.mobileUserAgent=b.getMobileUserAgent(),GEN_DEBUG&&console.log("MOBILE USER AGENT: ",e.mobileUserAgent)):e.mobileBrowser=!1,p.isUserLoggedIn()?(NETWORK_DEBUG&&console.log("User is logged in, checking for connection"),d.isSocketConnected()||d.init(),N()):g.isSmartStadiumUser()?(console.log("SS User? ",e.isSmartStadiumUser),f.loginWithEmail(N)):g.isTechMUser()?(console.log("Topic Found MI16"),r.url("/login?MI16=true")):g.isMWCUser()?(console.log("Topic Found MWC"),r.url("/login?MWC=true")):g.isPeelUser()?f.loginWithPeel(N):f.loginAsGuest(N),e.commentsArray||(e.loadingChat=!0),void 0==w.getChannel()&&void 0==u.getChannel()&&(GOOGLE_ANALYTICS===!0&&ga("send","pageview","/topic/"+l.topicID),GEN_DEBUG&&console.log("Sent Pageview from /topic/"+l.topicID)),u.setTopicId(l.topicID),e.topicType="livegame",e.innerButtonTapped=!1,p.isSmartStadiumUser()?(e.isSmartStadiumUser=!0,GEN_DEBUG&&console.log("SS USER HASNT VISITED"),e.hideSSSplash=!1,T.setToLocalStorage("hasUserVisited",!0),s(function(){e.continueToExperience("smartS")},7e3)):p.isMI16User()||g.isTechMUser()?e.isMI16User=!0:p.isMWCUser()||g.isMWCUser()?e.isMWCUser=!0:p.isPeelUser()?(e.isPeelUser=!0,g.getPeelShowId()?e.peelShowId=!0:e.peelShowId=!1):(e.isPeelUser=!1,e.hidePeelSplash=!0,e.hideSSSplash=!0),e.continueToExperience=function(t){GEN_DEBUG&&console.log("CONTINUE XP CLICKED"),"peel"===t?(v.setPeelSplash(!0),e.hidePeelSplash=!0):"smartS"===t&&(v.setSSSplash(!0),e.hideSSSplash=!0)},e.switchTabs=function(t){var o=C.globalTime()-B;e.activeTab!=t&&y.browseSessionEvent(e.activeTab),y.addSession(t),console.log("ACTIVE TAB ********* "+e.activeTab+"TIME SPENT : "+o),GOOGLE_ANALYTICS===!0&&(ga("send","event","Tabs","ActiveTab",e.activeTab),ga("send","event","Tabs","TabSessionLength",e.activeTab,o)),B=C.globalTime(),"chat"===t&&(e.activeTab="chat",$(document).scrollTop(0),N(),C.setLastActiveTab("chat")),"video"===t&&(e.activeTab="video",$(document).scrollTop(0),C.setLastActiveTab("video")),"social"===t&&(e.activeTab="social",$(document).scrollTop(0),C.setLastActiveTab("social")),GEN_DEBUG&&console.log("Active Tab: ",e.activeTab)},e.loadRemainingCommentsTimeout=function(){s(function(){m.loadedComments()||(GEN_DEBUG&&console.log("LOADING REST OF COMMENTS..."),d.send(m.getCommentsRequest(l.topicID)),e.loadedAllComments=!0,m.setLoadedComments(!0))},7e3)},e.hideLoading=function(){GEN_DEBUG&&console.log("HIDING LOAD"),e.loadingChat=!1,e.loadingSocial=!1},e.viewPost=function(e,t){if(-1!==window.location.href.indexOf("?"))var o=window.location.href.slice(window.location.href.indexOf("?"));$(e.target).is("a")||(u.currentTimer()&&c.cancel(u.currentTimer(!1)),U.resetVideoOffset(),S.resetSocialOffset(),void 0!==o?r.url("/post/"+t+o):r.url("/post/"+t))},e.peelClose=function(){GOOGLE_ANALYTICS===!0&&ga("send","event","Peel","click","BackToPeelHome");var t=C.globalTime()-B;GOOGLE_ANALYTICS===!0&&ga("send","event","Tabs","TabSessionLength",e.activeTab,t),B=C.globalTime(),GEN_DEBUG&&console.log("peelClose()"),window.location="peel://home"},e.peelWatchOnTV=function(){GOOGLE_ANALYTICS===!0&&ga("send","event","Peel","click","PeelWatchOnTV"),GEN_DEBUG&&console.log("peelWatchOnTV()");var e=g.getPeelShowId();GEN_DEBUG&&console.log("Peel show on TV uri :  peel://tunein/"+e+"?action=SendIRorReminder&post_action=None"),void 0!=e?window.location="peel://tunein/"+e+"?action=SendIRorReminder&post_action=None":window.location="peel://home"},e.showNewCommentsIndicator=!1,e.newCommentsIndicatorTapped=function(){GEN_DEBUG&&console.log("newCommentsIndicatorTapped"),e.showNewCommentsIndicator=!1,D(),$(document).scrollTop(0)},e.imageClick=function(e){event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation(),$.magnificPopup.open({items:{type:"image",src:e},type:"inline",callbacks:{open:function(){$("body").bind("touchmove",function(e){e.preventDefault()})},close:function(){$("body").unbind("touchmove")}}})},e.moreButtonTapped=function(){e.innerButtonTapped=!0},e.updateLikeTopic=function(){GEN_DEBUG&&console.log("TopicController update like Topic"),1==u.getLiked()?d.send(u.getUnlikeTopicRequest()):d.send(u.getLikeTopicRequest())},e.commentOnTopic=function(){document.getElementById("topicCommentField").focus()},e.updateLikeComment=function(t){e.innerButtonTapped=!0,GEN_DEBUG&&console.log("TopicController updateLike ("+t+")"),m.isCommentLiked(t)?d.send(m.getUnlikeCommentRequest(t)):d.send(m.getLikeCommentRequest(t))},e.deleteComment=function(t){GEN_DEBUG&&console.log("deleteComment("+t+")"),1===e.commentsArray.length&&(GEN_DEBUG&&console.log("Deleting Final Comment"),R=!0),e.innerButtonTapped=!0,d.send(m.deleteCommentRequest(t))},e.reportCommentAsSpam=function(t){GEN_DEBUG&&console.log("reportCommentAsSpam("+t+")"),e.innerButtonTapped=!0,d.send(m.flagCommentRequest(t))},e.goToRepliesWithKeyboardTriggered=function(e){if(-1!==window.location.href.indexOf("?"))var t=window.location.href.slice(window.location.href.indexOf("?"));u.currentTimer()&&c.cancel(u.currentTimer(!1)),u.directComment=!0,U.resetVideoOffset(),S.resetSocialOffset(),void 0!==t?r.url("/post/"+e+t):r.url("/post/"+e)};var L=p.isGuestUser();e.secureLink=function(e,t){return L?"":e+t};var _=function(){if(void 0==e.commentsArray)D();else{var t=m.comments(),o=t.length,n=m.getNumPinComments();e.commentsArray.length<o?p.isCurrentUser(t[n].author.id)?D():e.showNewCommentsIndicator=!0:D()}};u.registerObserverCallback(I),m.registerObserverCallback(_),m.registerObserverCallback(function(){D(!0)},!0),e.trustSrc=function(e){return o.trustAsResourceUrl(e)},n.addEventListener("beforeunload",function(){GEN_DEBUG&&console.log("Before Unload"),C.sessionReset()||C.endSession()}),e.xLinkActivated=!1;var P=w.getChannel();u.setChannel(P);var F,W,x,K,V,q,j,H,z=!1;e.setDocVars=function(){z||(F=$("#inputControls"),W=$(".tabContainer"),x=F.offset().top,K=W.height(),V=F.height(),q=document.documentElement.clientHeight,j=$(document).height(),z=!0,H=e.isSmartStadiumUser?54:e.isPeelUser&&e.peelShowId?54:0)};var Y=!1,J=function(){e.showNewCommentsIndicator&&(e.showNewCommentsIndicator=!1),$(document).scrollTop()>x-H&&j-q>x+V-K?(F.addClass("fixTabsPeel"),F.css("top",H),W.addClass("fixTabContainer"),$(".commentsContainer").css("padding-top",$("#inputControls").height()),Y=!0):Y&&(F.removeClass("fixTabsPeel"),F.css("top",""),W.removeClass("fixTabContainer"),$(".commentsContainer").css("padding-top",""),Y=!1)},X=O(function(){if("chat"===e.activeTab){var t=document.documentElement.clientHeight||window.innerHeight,o=$(document).height()-t-150;$(document).scrollTop()>o&&o>500&&G()}},100);$(document).off("scroll"),$(document).on("scroll",J),$(document).on("scroll",X)}]),angular.module("SocialModule",["NetworkModule","ChannelModule","TopicModule"]).controller("SocialController",["$scope","$sce","$window","$routeParams","$interval","$http","SocialService","VideoService","networkService","ChannelService","TopicService","DateUtilityService","CommentService","URIHelper","AnalyticsService",function(e,t,o,n,i,r,a,s,c,l,d,u,m,p,g){function f(){v(),h(),d.currentTimer()&&i.cancel(d.currentTimer(!1)),GEN_DEBUG&&console.log("$AUTO$ INIT");var e=i(function(){c.send(a.getSocialDataRequestAutoSingle(d.getChannelId())),p.isTechMUser()||p.isMWCUser()||c.send(s.getVideoDataRequestAutoSingle(d.getChannelId()))},15e3);d.currentTimer(e)}function v(){a.registerObserverCallback(function(){T("social")},"new"),s.registerObserverCallback(function(){T("video")},"new")}function h(){a.registerObserverCallback(function(){E("social")},!0),p.isTechMUser()||p.isMWCUser()||s.registerObserverCallback(function(){E("video")},!0)}function T(e){"social"===e&&(GEN_DEBUG&&console.log("$AUTO$ NEW SOCIAL PRESENT - SEND FULL REQUEST"),c.send(a.getSocialDataRequestAuto(d.getChannelId()))),"video"===e&&(GEN_DEBUG&&console.log("$AUTO$ NEW VIDEO PRESENT - SEND FULL REQUEST"),c.send(s.getVideoDataRequestAuto(d.getChannelId())))}function E(t){if("social"===t){var o=a.socialArrayAutoLength(),n=a.getPrevLength();GEN_DEBUG&&console.log("$AUTO$ UPDATE JEWEL[S] - ",{prevLength:n,newLength:o}),o>n&&("social"===e.$parent.activeTab?0!==n&&(I.newSocialAvailable=!0):(GEN_DEBUG&&console.log("$AUTO$ PULSE SOCIAL JEWEL"),S("social")),a.setPrevLength(o))}if("video"===t){var o=s.videoArrayAutoLength(),n=s.getPrevLength();GEN_DEBUG&&console.log("$AUTO$ UPDATE JEWEL[V] - ",{prevLength:n,newLength:o}),o>n&&("video"===e.$parent.activeTab?0!==n&&(I.newVideoAvailable=!0):(GEN_DEBUG&&console.log("$AUTO$ PULSE VIDEO JEWEL"),S("video")),s.setPrevLength(o))}}function S(e){var t;"social"===e&&(t=document.getElementById("socialJewel")),"video"===e&&(t=document.getElementById("videoJewel")),t.classList.remove("pulse"),t.offsetWidth=t.offsetWidth,t.classList.add("pulse")}function U(e){var t;"social"===e&&(t=document.getElementById("socialJewel")),"video"===e&&(t=document.getElementById("videoJewel")),t.classList.remove("pulse")}function w(){window.twttr=function(e,t,o){var n,i=e.getElementsByTagName(t)[0],r=window.twttr||{};return e.getElementById(o)?r:(n=e.createElement(t),n.id=o,n.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i),r._e=[],r.ready=function(e){r._e.push(e)},r)}(document,"script","twitter-wjs")}function b(e){var t,o,n;"social"===e?(t=a.socialArray(),I.socialArray=I.socialArray||[],o=I.socialArray.length,n=I.socialArray):(t=s.videoArray(),I.videoArray=I.videoArray||[],o=I.videoArray.length,n=I.videoArray);var i=t.length;if(t&&i>0)for(var r=0;i>r;r++){for(var c=t[r],l=!1,d=0;o>d;d++)c.id===n[d].id&&(l=!0);l||(c.postAuthorName=t[r].embedAuthor.name,c.postAuthorAlias=t[r].embedAuthor.alias,c.postAuthorPhoto=t[r].embedAuthor.photo,c.tweetId=t[r].tweet.id,c.postTimestamp=t[r].createdAt,c.providerName=t[r].embedProvider.name,c.html=t[r].embedText,c.retweetCount=t[r].tweet.metrics.retweetCount,c.likeCount=t[r].tweet.metrics.likeCount,c.replyCount=t[r].tweet.metrics.replyCount,c.embed=t[r].embed,c.embed.embedCreatedAt=t[r].embedCreatedAt,"Twitter"===c.providerName?(c.providerLogo="img/twitterLogo@2x.png",c.embed.provider.logo="img/twitterLogo@2x.png"):(c.providerLogo=t[r].embedProvider.logo,c.embed.provider.logo=t[r].embedProvider.logo),c.embedType=t[r].embedType,c.embedUrl=t[r].embedUrl,"link"===t[r].embedType&&t[r].embedPlayable===!0&&(c.embedHtml=t[r].embedHtml,c.embedPlayable=!0),"media"!==t[r].embedType&&"link"!==t[r].embedType||(c.mediaType=t[r].embedMedia.mediaType,c.mediaUrl=t[r].embedMedia.mediaUrl,c.mediaThumbUrl=t[r].embedMedia.mediaThumbUrl,c.mediaAspectRatio=t[r].embedMedia.mediaAspectRatio,c.mediaAspectFeed=t[r].embedMedia.mediaAspectFeed,c.mediaAspectFull=t[r].embedMedia.mediaAspectFull,c.mediaOrientation=t[r].embedMedia.mediaOrientation),"social"===e?I.socialArray.push(c):I.videoArray.push(c),NETWORK_DEBUG&&r===i-1&&("social"===e?console.log("Social Array: ",I.socialArray):console.log("Video Array: ",I.videoArray)))}}function y(e){if("social"===e){if(!I.socialArray)return;for(var t=0;t<I.socialArray.length;t++)I.socialArray[t].postTimestamp=u.getTimeSince(I.socialArray[t].createdAtFull)}else{if(!I.videoArray)return;for(var t=0;t<I.videoArray.length;t++)I.videoArray[t].postTimestamp=u.getTimeSince(I.videoArray[t].createdAtFull)}}function C(e,t,o){var n;return function(){var i=this,r=arguments,a=function(){n=null,o||e.apply(i,r)},s=o&&!n;clearTimeout(n),n=setTimeout(a,t),s&&e.apply(i,r)}}function A(){GEN_DEBUG&&console.log("Scroll Up to Top of Frame");var e={type:"scroll"};parent.postMessage(e,"http://www.fankave.net")}console.log("Social Control"),setTimeout(f,6e3);var I=this;this.initFeed=function(t){"social"===t?(I.newSocialAvailable&&(I.newSocialAvailable=!1),U("social"),I.socialArray?b("social"):(e.$parent.loadingSocial=!0,I.loadContent("social")),y("social"),e.$parent.switchTabs("social"),I.loadContent("social"),window.twttr||w()):(I.newVideoAvailable&&(I.newVideoAvailable=!1),U("video"),I.videoArray?b("video"):(e.$parent.loadingSocial=!0,I.loadContent("video")),y("video"),e.$parent.switchTabs("video"),I.loadContent("video"),window.twttr||w())},e.$on("videoActive",function(t,o){e.$parent.activeTab="video",ANALYTICS&&g.addSession("video"),p.tabEntered(),e.$parent.activeTab="video",I.initFeed("video")}),e.$on("socialActive",function(t,o){e.$parent.activeTab="social",ANALYTICS&&g.addSession("social"),p.tabEntered(),e.$parent.activeTab="social",I.initFeed("social")}),this.loadContent=function(e,t){var o=l.getChannel()||d.getChannelId();"social"===e?(NETWORK_DEBUG&&console.log("LOADING SOCIAL: ",o),c.send(a.getSocialDataRequest(o,t))):(NETWORK_DEBUG&&console.log("LOADING VIDEO: ",o),c.send(s.getVideoDataRequest(o,t)))},a.registerObserverCallback(function(){b("social")}),s.registerObserverCallback(function(){b("video")});var D=document.documentElement.clientHeight||window.innerHeight,G=C(function(){var t=$(document).height()-D-150;$(document).scrollTop()>t&&t>500&&("social"===e.activeTab?I.loadContent("social"):"video"===e.activeTab&&I.loadContent("video"))},100);$(document).on("scroll",G),this.retweetPost=function(e){r({method:"GET",url:"https://twitter.com/intent/retweet?tweet_id="+e,headers:{"Access-Control-Allow-Origin":"*"}})},this.shareTweetToChat=function(t,o){I.embedShareContent=t,I.showShareDialog=!0;var n=$("#"+o).offset().top+"px";if(GEN_DEBUG&&console.log("Embed Object: ",t,n),p.embedded()&&setTimeout(function(){$("#sharePreviewContainer").css({top:n})},0),e.$parent.isPeelUser&&e.$parent.peelShowId){var i=document.documentElement.clientHeight-54;GEN_DEBUG&&console.log("fullClient Height: ",i),setTimeout(function(){$("#sharePreviewContainer").css({top:"54px"}).height(i)},25)}},this.submitSharedPost=function(t,o){var n=e.$parent.topicID;GEN_DEBUG&&console.log("topicID From Parent: ",n),c.send(m.postCommentRequestForShare(n,t,o)),I.showShareDialog=!1,e.$parent.switchTabs("chat"),p.embedded()&&A()},this.shareToFacebook=function(e,t){FB.ui({method:"share",href:t},function(e){GEN_DEBUG&&console.log("FB Response Post-Share: ",e)})},this.exitShare=function(){I.showShareDialog=!1},this.highlightPost=function(){$("#postShareContent").css("color","rgb(22,189,231)")},this.unhighlightPost=function(){$("#postShareContent").css("color","rgb(211,214,215)")},this.showNewSocial=function(){I.newSocialAvailable=!1,b("social");var e=$("body");e.stop().animate({scrollTop:0},"500","swing")},this.showNewVideo=function(){I.newVideoAvailable=!1,b("video");var e=$("body");e.stop().animate({scrollTop:0},"500","swing")},this.reportSocialInteraction=function(e,t,o){g.expressSocialEvent(t,e.id,e.type,e.tweetId,e.providerName,o)}}]),angular.module("UserInput",["NetworkModule","TopicModule","MediaModule","angularFileUpload"]).controller("UserInputController",["$scope","$window","$timeout","$routeParams","networkService","TopicService","CommentService","ReplyService","UserInfoService","FileUploader","MUService",function(e,t,o,n,i,r,a,s,c,l,d){function u(t){var o=t.target.files[0];if(GEN_DEBUG&&console.log("F:",o),!o.type.match("image.*"))var n="img/videoPrevIcon@2x.png";var i=new FileReader;i.onload=function(t){return function(t){var o=document.createElement("span");o.innerHTML=['<img class="thumb" src="',n||t.target.result,'"/>'].join(""),e.mobileBrowser!==!0||f?f||document.getElementById("preview").insertBefore(o,null):document.getElementById("mobilePreview").insertBefore(o,null)}}(o),i.readAsDataURL(o)}var m;m=DEV_BUILD===!0?"https://dev.fankave.com:8080":"https://mus.fankave.com";var p="/v1.0/media/upload",g=(this.uploader=new l({url:m+p,autoUpload:!1,removeAfterUpload:!0,queueLimit:1}),this);this.isHTML5=this.uploader.isHTML5,this.mediaType,this.uploader.filters.push({name:"customFilter",fn:function(e,t){var o=e.type;return-1!=o.indexOf("image")?(g.mediaType="image",this.queue.length<1&&e.size<5242880):-1!=o.indexOf("video")?(g.mediaType="video",this.queue.length<1&&e.size<268435456):this.queue.length<10}});var f;document.getElementById("fileUpload").addEventListener("change",u,!1),this.removeMedia=function(){g.uploader.clearQueue();var e=$("#fileUpload");e.wrap("<form>").closest("form").get(0).reset(),e.unwrap(),f=!1,g.unhighlightPost()},this.fileMaxExceeded=!1,this.uploader.onWhenAddingFileFailed=function(e,t,n){f=!0,GEN_DEBUG&&console.info("onWhenAddingFileFailed",e,t,n),g.isHTML5?g.uploader.queue.length<1&&(g.fileMaxExceeded=!0,g.removeMedia(),o(function(){g.fileMaxExceeded=!1},5e3)):(GEN_DEBUG&&console.log("Browser Doesn't Support HTML5"),g.HTML5warning=!0)},this.uploader.onAfterAddingFile=function(e){GEN_DEBUG&&console.info("onAfterAddingFile",e),g.highlightPost()},this.uploader.onAfterAddingAll=function(e){GEN_DEBUG&&console.info("onAfterAddingAll",e)},this.uploader.onBeforeUploadItem=function(e){var t=c.getUserCredentials();e.headers={"X-UserId":t.userId,"X-SessionId":t.sessionId,"X-AccessToken":t.accessToken},e.formData=[{type:e._file.type},{size:e._file.size},{file:e._file}],GEN_DEBUG&&console.info("onBeforeUploadItem",e)},this.uploader.onProgressItem=function(e,t){GEN_DEBUG&&console.info("onProgressItem",e,t)},this.uploader.onProgressAll=function(e){GEN_DEBUG&&console.info("onProgressAll",e)},this.uploader.onSuccessItem=function(e,t,o,n){GEN_DEBUG&&console.info("onSuccessItem",e,t,o,n),i.send(d.postMediaRequest(t))},this.uploader.onErrorItem=function(e,t,o,n){GEN_DEBUG&&console.info("onErrorItem",e,t,o,n)},this.uploader.onCancelItem=function(e,t,o,n){GEN_DEBUG&&console.info("onCancelItem",e,t,o,n)},this.uploader.onCompleteItem=function(e,t,o,n){GEN_DEBUG&&console.info("onCompleteItem",e,t,o,n)},this.uploader.onCompleteAll=function(){GEN_DEBUG&&console.info("onCompleteAll"),g.uploader.clearQueue(),d.resetCommentParams()},GEN_DEBUG&&console.info("uploader",this.uploader),this.postComment=function(t,o){g.uploader.queue.length>0&&o?d.setCommentParams(e.topicID,t,!0):g.uploader.queue.length>0&&!o?d.setCommentParams(e.topicId,t,!1,e.postID):t&&""!==t&&o?i.send(a.postCommentRequest(e.topicID,t)):t&&""!==t&&!o&&i.send(s.getPostReplyRequest(e.topicId,e.postID,t)),g.uploader.uploadAll(),e.commentText="",$("input#topicCommentField").blur(),$("#postCommentButton").css("color","rgb(211,214,215)"),o?$(document).scrollTop(0):window.scrollTo(0,document.body.scrollHeight)},this.highlightPost=function(){GEN_DEBUG&&console.log("Styling post"),$("#postCommentButton").css("color","rgb(22,189,231)")},this.unhighlightPost=function(){GEN_DEBUG&&console.log("Styling post"),$("#postCommentButton").css("color","rgb(211,214,215)")},this.mobileHighlightPost=function(){$("#postCommentButton").css("color","rgb(22,189,231)")},this.mobileUnhighlightPost=function(){$("#postCommentButton").css("color","rgb(22,189,231)")},$("input#topicCommentField").bind("focusin focus",function(e){e.preventDefault()}),$("input").bind("focusin focus",function(e){e.preventDefault()})}]),angular.module("TopicModule").directive("secureClick",["$location","$window","UserInfoService",function(e,t,o){return{restrict:"A",link:function(t,n,i){var r=n[0];$(r).on("click",function(n){n.preventDefault(),o.isGuestUser()?(e.url("/login"),t.$apply()):t.$eval(i.secureClick)})}}}]),angular.module("TopicModule").directive("secureFocus",["$location","$window","UserInfoService",function(e,t,o){return{restrict:"A",link:function(t,n,i){var r=n[0];$(r).on("focus",function(n){n.preventDefault(),o.isGuestUser()?(e.url("/login"),t.$apply()):t.$eval(i.secureFocus)})}}}]),angular.module("TopicModule").directive("repeatFinishedNotify",function(){return function(e,t,o){e.$last&&(e.hideLoading(),e.setDocVars(),e.continueToExperience("smartS"))}}),angular.module("TopicModule").directive("embedSharedContent",["UserAgentService",function(e){return{restrict:"E",scope:{thisPost:"=embedPost",trustSource:"&",preventNav:"&"},link:function(t,o,n){t.mobileUserAgent=e.getMobileUserAgent()},templateUrl:"partials/shared.html"}}]),angular.module("Forum").factory("UserAgentService",["ForumStorage","UserInfoService","deviceDetector",function(e,t,o){function n(){var e;return i()&&(/iPad|iPhone|iPod/i.test(navigator.userAgent)&&!window.MSStream?e="iOS":/Android/i.test(navigator.userAgent)?e="android":/IEMobile/i.test(navigator.userAgent)&&(e="windows")),f=e,e}function i(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function r(e){return f===e}function a(){var e,t,n=o.raw,r=o.os,a=o.browser,f=o.device,v="desktop-web";if("mac"===r&&("chrome"===a?(e=s(n.userAgent),t=l(n.userAgent)):"safari"===a?(e=s(n.userAgent),t=u(n.userAgent)):"firefox"===a&&(e=c(n.userAgent),t=d(n.userAgent))),"windows"===r)for(var h in n.os_version)n.os_version.hasOwnProperty(h)&&n.os_version[h]===!0&&(e=h);"ios"===r&&(e=m(n.userAgent),"safari"===a&&(t=g(n.userAgent))),"android"===r&&(e=p(n.userAgent),"chrome"===a&&(t=l(n.userAgent))),i()&&(v="mobile-web"),void 0==e&&(e="");var T={platform:v,appVersion:"1.0",osType:r,osVersion:e,browserType:a,browserVersion:t
};return"unknown"!==f&&(T.device=f),T}function s(e){return-1!==e.indexOf("Mac OS X")?(e=e.slice(e.indexOf("Mac OS X")+9),e.slice(0,e.indexOf(")"))):null}function c(e){return-1!==e.indexOf("Mac OS X")?(e=e.slice(e.indexOf("Mac OS X")+9),e.slice(0,e.indexOf(";"))):null}function l(e){return-1!==e.indexOf("Chrome/")?(e=e.slice(e.indexOf("Chrome/")+7),e.slice(0,e.indexOf(" "))):null}function d(e){return-1!==e.indexOf("Firefox/")?e=e.slice(e.indexOf("Firefox/")+8):null}function u(e){return-1!==e.indexOf("Version/")?(e=e.slice(e.indexOf("Version/")+8),e.slice(0,e.indexOf(" "))):null}function m(e){return-1!==e.indexOf("CPU iPhone OS")?(e=e.slice(e.indexOf("CPU iPhone OS")+14),e.slice(0,e.indexOf(" "))):null}function p(e){return-1!==e.indexOf("Linux; Android")?(e=e.slice(e.indexOf("Linux; Android")+15),e.slice(0,e.indexOf(";"))):null}function g(e){return-1!==e.indexOf("Version/")?(e=e.slice(e.indexOf("Version/")+8),e.slice(0,e.indexOf("/"))):null}var f;return{getMobileUserAgent:n,isMobileUser:i,isUserAgent:r,getDeviceInfo:a}}]),angular.module("NetworkModule",["ngWebSocket"]).factory("networkService",["$websocket","$route","DataService","UserInfoService","URIHelper",function(e,t,o,n,i){function r(){function t(){if(i.isPeelUser())return r();var e=n.getUserCredentials(),t=WEBSOCKET_BASE_URI+"userId="+e.userId+"&sessionId="+e.sessionId+"&accessToken="+e.accessToken+"/";return NETWORK_DEBUG&&console.log("socketUri: "+t),t}function r(){var e=WEBSOCKET_BASE_URI_PEEL+"userId="+i.getPeelUserId()+"&userName="+i.getPeelUserName()+"/";return NETWORK_DEBUG&&console.log("socketUri: "+e),e}void 0!=a&&a.close(),a=e(t()),o.setWatchTopic(!1),a.onOpen(function(){NETWORK_DEBUG&&console.log("Websocket Connected")}),a.onClose(function(e){a=void 0,NETWORK_DEBUG&&console.log("Websocket Closed :"+e.data)}),a.onMessage(function(e){NETWORK_DEBUG&&console.log("Websocket Message Recieved :  "+e.data);var t=JSON.parse(e.data),r=t.rid;void 0!==r&&("context"!==r&&"hello"!==r||(NETWORK_DEBUG&&console.log("Processing context"),o.setAnalytics(t),i.isPeelUser()&&n.setUserCredentials(t.data.userId,t.data.sessionId,"Peel")),"channel"===r&&(NETWORK_DEBUG&&console.log("Processing Channel"),o.setChannel(t)),"topic"===r||"score"===r?(NETWORK_DEBUG&&console.log("Processing Topic"),o.setTopic(t)):"comment"===r?(NETWORK_DEBUG&&console.log("Processing Comments"),o.setComments(t)):"reply"===r?(NETWORK_DEBUG&&console.log("Processing Reply"),o.setReplies(t)):"social"===r||"social_auto"===r?(NETWORK_DEBUG&&console.log("Processing Social"),o.setSocial(t)):"video"===r||"video_auto"===r?(NETWORK_DEBUG&&console.log("Processing Video"),o.setVideo(t)):"loginId"===r&&NETWORK_DEBUG&&console.log("Processing loginId"))}),a.onError(function(e){NETWORK_DEBUG&&console.log("Websocket OnError: ",e)})}var a;return{isSocketConnected:function(){return NETWORK_DEBUG&&(null!=a?NETWORK_DEBUG&&console.log("ws status : "+a.readyState+"ws.OPEN :"+a.OPEN):NETWORK_DEBUG&&console.log("ws is null")),void 0!=a&&1==a.readyState},send:function(e){void 0==a&&r(),a.send(JSON.stringify(e))},closeSocket:function(){void 0!=a&&a.close()},init:r}}]),angular.module("NetworkModule").factory("ForumStorage",function(){function e(e,t){void 0!=localStorage&&n&&localStorage.setItem(e,t)}function t(e){return void 0!=localStorage&&n?localStorage.getItem(e):void 0}function o(){void 0!=localStorage&&n&&localStorage.clear()}var n=!1;return void 0!=typeof Storage?(NETWORK_DEBUG&&console.log("Local storage available :"+typeof Storage),n=!0):NETWORK_DEBUG&&console.log("Sorry! No Storage support on this browser.."),{getFromLocalStorage:t,setToLocalStorage:e,clearStorage:o}}),angular.module("NetworkModule").factory("ForumDeviceInfo",["ForumStorage",function(e){function t(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}function o(){GEN_DEBUG&&console.log("GEnerating UUID");var e=t()+t(!0)+t(!0)+t();return GEN_DEBUG&&console.log(" UUID :"+e),e}return{getDeviceId:function(){var t=e.getFromLocalStorage("forumUUID");return(void 0==t||t.length<15)&&(t=o(),e.setToLocalStorage("forumUUID",t)),GEN_DEBUG&&console.log("generated ID : "+t),t}}}]),angular.module("NetworkModule").factory("URIHelper",["ForumStorage","$rootScope",function(e,t){function o(){for(var e,t=[],o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<o.length;n++)e=o[n].split("="),t.push(e[0]),t[e[0]]=e[1];return t}var n,i,r,a,s,c,l,d;return{isPeelUser:function(){var t=o();if(t.peel){i=t.userId,n=t.userName,r=t.showId;e.getFromLocalStorage("forumUserType");return e.setToLocalStorage("forumPeelUserId",i),e.setToLocalStorage("forumPeelShowId",r),!0}return!1},isSmartStadiumUser:function(){var t=o();return t.smartStadium?(s=t.userId,a=t.userName,e.setToLocalStorage("forumSmartStadiumUserId",s),!0):!1},isTechMUser:function(){var t=o();return t.MI16?(c=!0,e.setToLocalStorage("techMIUser",!0),!0):!!c},isMWCUser:function(){var t=o();return t.MWC?(l=!0,e.setToLocalStorage("MWCUser",!0),!0):!!l},getPeelUserId:function(){return i},getPeelUserName:function(){return n},getPeelShowId:function(){return r},getPeelParams:function(){return window.location.search.substring(1)},getSSUserId:function(){return s},getSSUserName:function(){return a},getActiveTab:function(){var e=o();if(e.tab){if("video"===e.tab)return"video";if("social"===e.tab)return"social"}},isSuperBowl:function(){var e=o();return!!e.superbowl},tabEntered:function(){d=!0},tabEntry:function(){return d},extractOffset:function(e){var t=e.slice(e.indexOf("offset")),o=t.split("=");return o[1]},embedded:function(){var e=o();return e.embed?(console.log("Embed found in URL"),t.embed=!0,!0):t.embed?(console.log("Embed found on rootScope"),!0):!1}}}]),angular.module("ChannelModule").factory("ChannelService",["DateUtilityService","Bant","FDSUtility",function(e,t,o){function n(e){void 0!=e.data&&(s=e.data.id,NETWORK_DEBUG&&console.log("_liveTopicId : "+s),l())}function i(e){var t=e||a,o="/v1.0/channel/topic/show/"+t+"?type=livegame";"404"!=t&&"5066"!=t||(o="/v1.0/channel/topic/show/"+t);var n={rid:"channel",timestamp:(new Date).getTime(),method:"GET",uri:o};return NETWORK_DEBUG&&console.log("Ch.getLiveGameTopic: ",n),n}function r(e){for(var t=c.length;t>0;)t=c.length,c.pop();c.push(e)}var a,s,c=[],l=function(){angular.forEach(c,function(e){e()})};return{setTopicData:n,getLiveTopicId:function(){return s},getLiveGameTopic:i,setChannel:function(e){a=e},getChannel:function(){return a},registerObserverCallback:r}}]),angular.module("NetworkModule").service("DataService",["TopicService","CommentService","ReplyService","ChannelService","SocialService","VideoService","AnalyticsService",function(e,t,o,n,i,r,a){function s(o){if(o.error)NETWORK_DEBUG&&console.log("Comments Error message from network: ",o.error);else if(o.push)"UPSERT"==o.method&&(0==t.updateComment(o)?e.updateCommentCount(1):"REMOVE"==o.method);else if("POST"==o.method){var n=o.uri;if(void 0!=n){var i=n.slice(-g);"/v1.0/comment/create"==n?(t.appendToComments(o),e.updateCommentCount(1)):0==t.updateCommentLocalData(n,i)&&e.updateCommentCount(-1)}}else t.setComments(o)}function c(t){t.error?NETWORK_DEBUG&&console.log("Topic Error message from network: ",t.error):t.push?"UPSERT"==t.method?e.updateTopic(t.data):"REMOVE"==t.method&&e.removeTopic(t.data):e.setTopic(t)}function l(e){if(e.error)NETWORK_DEBUG&&console.log("Topic Error message from network: ",e.error);else if(e.push)NETWORK_DEBUG&&console.log("reply pushed "),"UPSERT"==e.method&&(0===o.updateReply(e)?void 0!=e.data&&t.updateReplyCountById(e.data.commentId,1):"REMOVE"==e.method);else if("POST"==e.method){var n=e.uri;if(void 0!=n){var i=n.slice(-g);if("/v1.0/reply/create"==n)o.appendToReplies(e),void 0!=e.data&&t.updateReplyCountById(e.data.commentId,1);else{var r=o.getCommentIdByReply(i);0==o.updateReplyLocalData(n,i)&&t.updateReplyCountById(r,-1)}}}else o.setReplies(e)}function d(e){e.error?NETWORK_DEBUG&&console.log("Topic Error message from network: ",e.error):(NETWORK_DEBUG&&console.log("delegateSetChannel: ",e),n.setTopicData(e))}function u(e){e.error?NETWORK_DEBUG&&console.log("Social Error message from network: ",e.error):(NETWORK_DEBUG&&console.log("SOCIAL GET"),i.setSocialData(e))}function m(e){e.error?NETWORK_DEBUG&&console.log("Video Error message from network: ",e.error):(NETWORK_DEBUG&&console.log("VIDEO GET"),r.setVideoData(e))}function p(t){t.error?NETWORK_DEBUG&&console.log("Video Error message from network: ",t.error):(NETWORK_DEBUG&&console.log("VIDEO GET"),a.setLoginSessionId(t.data.analytics.sessionId,t.data.userId,t.data.sessionId,n.getChannel(),e.getTopicId()))}var g=16;return{setVideo:m,setSocial:u,setChannel:d,setTopic:c,setComments:s,setReplies:l,setAnalytics:p,setWatchTopic:function(t){e.setWatchTopic(t)}}}]),angular.module("TopicModule").service("TopicService",["DateUtilityService","Bant","FDSUtility",function(e,t,o){function n(o){void 0!=o.data?(void 0!=o.data.content&&(h=o.data.content.title),f=o.data.topicType,NETWORK_DEBUG&&console.log("TOPIC TYPE :"+f),v=o.data.id,"livegame"==f&&(T=o.data.game,void 0!=T&&(y=-1!==T.id.indexOf("cricket"),w=e.getGameScheduledTime(T.scheduledAt),S=T.score,void 0==S.live&&void 0==S["final"]?E="future":1==S.live?E="live":1==S["final"]&&(E="past",T.score.summary&&(b=T.score.summary)),"live"==E&&(NETWORK_DEBUG&&console.log("_gameStats"+S.status),U=S.status))),g=t.bant(o.data),R()):"POST"==o.method&&(o.uri==k+v?(NETWORK_DEBUG&&console.log("Topic watch success"),N=!0):o.uri==D+v?(NETWORK_DEBUG&&console.log("Topic liked success"),g=t.updateBantLiked(g,!0),R()):o.uri==G+v&&(NETWORK_DEBUG&&console.log("Topic unliked success"),g=t.updateBantLiked(g,!1),R()))}function i(e){NETWORK_DEBUG&&console.log("Topic Service scoreData :"+e),r(e)}function r(e){S=e,void 0!=S&&(1==S.live&&(E="live"),U=S.status,NETWORK_DEBUG,R())}function a(e){NETWORK_DEBUG&&console.log("Update comment count: "+g.metrics.comments+"     Value : "+e),void 0!=g&&void 0!=g.metrics&&(1==e?void 0==g.metrics.comments?g.metrics.comments=1:g.metrics.comments=g.metrics.comments+1:void 0==g.metrics.comments?g.metrics.comments=0:g.metrics.comments=g.metrics.comments-1),R()}function s(e){var t=I+e;return varTopicParams={rid:"topic",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(t)}}function c(){var e=0;void 0!=g&&void 0!=g.owner&&(e=g.owner.id),p=e;var t="/v1.0/channel/follow/"+e;return varTopicParams={rid:"topic",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(t)}}function l(e){var t=k+e;return varTopicParams={rid:"topic",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(t)}}function d(){return NETWORK_DEBUG&&console.log("Like topic request invoked"+v),varLikeParams={rid:"topic",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(D+v)}}function u(){return varLikeParams={rid:"topic",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(G+v)}}function m(e){for(var t=O.length;t>0;)t=O.length,O.pop();O.push(e)}var p,g,f,v,h,T,E,S,U,w,b,y,C,A,I="/v1.0/topic/show/",D="/v1.0/topic/like/",G="/v1.0/topic/unlike/",k="/v1.0/topic/watch/",N=!1,O=[],B=!1,R=function(){angular.forEach(O,function(e){e()})};return{getTopic:function(){return g},getTopicId:function(){return v},getTopicType:function(){return f},getGame:function(){return T},getGameTime:function(){return w},getTeamA:function(){return void 0!=T?T.teams[0]:void 0},getTeamB:function(){return void 0!=T?T.teams[1]:void 0},getScoresTitle:function(){return void 0!=T&&void 0!=T.links?T.links[0].title:void 0},getScoresLink:function(){return void 0!=T&&void 0!=T.links?T.links[0].url:void 0},getScore:function(){return void 0!=S?S:void 0},getGameStatus:function(){return E},getGamePeriod:function(){return U?U[0]:void 0},getGameClock:function(){return U?U[1]:void 0},getGameSummary:function(){return b},getOffense:function(){var e={};return S.detail&&(S.detail[0].offense?(e.team="leftTeam",e.position=S.detail[0].position):S.detail[1].offense&&(e.team="rightTeam",e.position=S.detail[1].position)),e},isGameCricket:function(){return y},getChannelId:function(){return void 0!=g?g.owner.id:void 0},getTitle:function(){return h},getHtml:function(){return void 0!=g?g.html:void 0},getTimeCreatedAt:function(){return void 0!=g?g.createdAt:void 0},getLiked:function(){return void 0!=g?g.signal.like:void 0},getMetrics:function(){return void 0!=g?g.metrics:void 0},watchTopicRequest:l,getLikeTopicRequest:d,getUnlikeTopicRequest:u,getFollowChannelRequest:c,getTopicRequest:s,isWatchingTopic:function(){return N},setWatchTopic:function(e){N=e},setTopicId:function(e){v=e},setChannel:function(e){p=e},getChannel:function(){return p},setTopic:n,updateTopic:i,updateCommentCount:a,registerObserverCallback:m,directComment:C,currentTimer:function(e){if(e===!1){console.log("$AUTO$ CANCEL TIMER");var t=A;return A=void 0,t}return e&&(console.log("$AUTO$ STORE TIMER"),A=e),console.log("$AUTO$ CURRENT TIMER ",A),A},fromPost:function(){return B},toggleFromPost:function(){B?B&&(B=!1):B=!0}}}]),angular.module("SplashModule",[]).factory("SplashService",function(){var e=!0,t=!0;return{hidePeelSplash:function(){return e},hideSSSplash:function(){return t},setPeelSplash:function(t){e=t},setSSSplash:function(e){t=e}}}),angular.module("NetworkModule").factory("CommentService",["Bant","DateUtilityService","FDSUtility","URIHelper",function(e,t,o,n){function r(t){if(F=[],tempCommentsData=t.data.results,void 0!=tempCommentsData&&tempCommentsData.length>0){var o=tempCommentsData.length;for(i=0;i<o;i++){var n={};n=e.bant(tempCommentsData[i]),void 0!=n.id&&F.push(n)}NETWORK_DEBUG&&console.log("Set Comments"),K(!0),W=t.data.nextOffset}else{var r=t.data;if("GET"==t.method&&t.uri.substring(0,D.length)==D){NETWORK_DEBUG&&console.log("Processing Show comment");var n={};n=e.bant(r),void 0!=n.id&&F.push(n),K(!0)}}}function a(t){var o=t.data;if(void 0!=o){var n={};if(n=e.bant(o),void 0!=n.id){var i=0;if(F.length>0)for(;1==F[i].pin;)i++;$=i,$>0?F.splice(i,0,n):F.unshift(n)}}K()}function s(t){var o=t.data;for(i=0;i<F.length;i++)if(F[i].id==o.id)return F[i]=e.bant(o),1;return a(t),NETWORK_DEBUG&&console.log("In Comment Service update comment"),0}function c(e){for(i=0;i<F.length;i++)if(F[i].id==e.id)return void(F[i]=e)}function l(t,o){if(NETWORK_DEBUG&&console.log("updateLikeCommentWithId :"+t+"   liked "+o),void 0!=t){var n;n=u(t),n=e.updateBantLiked(n,o),c(n),K(!0)}}function d(e){var t=e.data;for(i=0;i<F.length;i++)if(F[i].id==t.id)return F.splice(i,1),0;return 1}function u(e){for(NETWORK_DEBUG&&console.log("_comments :"+F.length),i=0;i<F.length;i++)if(F[i].id==e)return F[i]}function m(e,t){if(t){for(var o=P.length;o>0;)o=P.length,P.pop();P.push(e)}else{for(var o=_.length;o>0;)o=_.length,_.pop();_.push(e)}}function p(e){var t;return t=0===W?"?limit=10&offset="+W:"?offset="+W,{rid:"comment",timestamp:(new Date).getTime(),method:"GET",uri:encodeURI(e+t)}}function g(e){return{rid:"comment",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(e)}}function f(e){var t=I+e;return p(t)}function v(e){var t=D+e;return p(t)}function h(e,t){var o=g(G);return o.data={lang:"en",content:{sections:[{type:"html",html:t}]},topicId:e},o}function T(e,t,o){var n={media:[o]},i=g(G);return i.data={lang:"en",content:{sections:[{type:"html",html:t},{type:"media"}]},topicId:e},i.data.content.sections[1].media=n.media,NETWORK_DEBUG&&console.log("Media comment Request :"+JSON.stringify(i,null,10)),i}function E(e,t,o){var n=g(G);return n.data={lang:"en",content:{sections:[{type:"html",html:t},{type:"embed"}]},topicId:e},n.data.content.sections[1].embed=o,NETWORK_DEBUG&&console.log("Media comment Request :"+JSON.stringify(n,null,10)),n}function S(e){return g(N+e)}function U(e){return g(O+e)}function w(e){return g(M+e+"?reason=spam")}function b(e){return g(k+e)}function y(e){return o.isLikedById(F,e)}function C(e,t){if(void 0!=e){var o=u(e);void 0!=o&&(NETWORK_DEBUG&&console.log("found element :"+o+" tempStructure.metrics.replies :"+o.metrics.replies),-1==t?void 0==o.metrics.replies?o.metrics.replies=0:o.metrics.replies=o.metrics.replies-1:void 0==o.metrics.replies?o.metrics.replies=1:o.metrics.replies=o.metrics.replies+1,c(o),NETWORK_DEBUG&&console.log("found element updated to :"+o+" tempStructure.metrics.replies :"+o.metrics.replies),K())}}function A(e,t){if(e==N+t)l(t,!0);else if(e==O+t)l(t,!1);else{if(e==k+t)return F=o.deleteById(F,t),K(),0;e==M+t?F=o.flagById(F,!1):e==L+t?F=o.flagById(F,!1):e==B+t?F=o.hideById(F,!0):e==R+t&&(F=o.hideById(F,!1))}}var I="/v1.0/topic/comments/list/",D="/v1.0/comment/show/",G="/v1.0/comment/create",k="/v1.0/comment/delete/",N="/v1.0/comment/like/",O="/v1.0/comment/unlike/",B="/v1.0/comment/hide/",R="/v1.0/comment/unhide/",M="/v1.0/comment/flag/",L="/v1.0/comment/unflag/",_=[],P=[],F=[],$=0,W=0,x=!1,K=function(e){e?angular.forEach(P,function(e){e()}):angular.forEach(_,function(e){e()})};return{comments:function(){return F},setComments:r,updateComment:s,appendToComments:a,updateLikeCommentWithId:l,updateCommentLocalData:A,updateReplyCountById:C,removeComment:d,postCommentRequest:h,postCommentRequestForMedia:T,postCommentRequestForShare:E,getLikeCommentRequest:S,getUnlikeCommentRequest:U,registerObserverCallback:m,getCommentsRequest:f,getCommentById:u,getCommentByIdRequest:v,deleteCommentRequest:b,flagCommentRequest:w,isCommentLiked:y,getNumPinComments:function(){return $},loadedComments:function(){return x},setLoadedComments:function(e){x=e}}}]),angular.module("NetworkModule").service("DateUtilityService",function(){function e(e){var t=new Date,o=new Date(e);if(secondsPast=(t.getTime()-o.getTime())/1e3,secondsPast<60)return"now";if(secondsPast<3600)return parseInt(secondsPast/60)+"m";if(secondsPast<86400)return parseInt(secondsPast/3600)+"h";if(secondsPast<2592e3){var n=secondsPast/86400;return Math.floor(n)+"d"}return secondsPast>2592e3?(day=o.getDate(),month=o.toDateString().match(/ [a-zA-Z]*/)[0].replace(" ",""),year=o.getFullYear()==t.getFullYear()?"":" "+o.getFullYear(),GEN_DEBUG&&console.log("DATE "+day+" "+month+year),day+" "+month+year):void 0}function t(e){var t="12",o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=new Date(e),r=i.getDate(),a=o[i.getDay()],s=i.getMonth()+1,c=n[i.getMonth()],l=i.getHours(),d=i.getMinutes(),u=l,m="";i.toLocaleString("en",{timeZoneName:"short"}).split(" ").pop();"12"==t&&(l>12?(m="PM",l-=12,10>l?u="0"+l:12==l&&(l="00",m="AM")):12>l?(u=10>l?"0"+l:l,m="AM"):12==l&&(m="PM")),10>d&&(d="0"+d),u=u+":"+d+" "+m;var p=s+"/"+r,g=a+", "+c+" "+r;return result={date:p,time:u,dateExt:g},GEN_DEBUG&&(console.log("Scheduled date : "+result.date+"  Scheduled time : "+result.time),console.log("Scheduled Date, Extended Format: ",result.dateExt)),result}return{getTimeSince:e,getGameScheduledTime:t}}),angular.module("NetworkModule").factory("Bant",["DateUtilityService",function(e){function t(e,t){return e.mediaType=t.mediaType.substring(r,0),"video"==e.mediaType&&(e.mediaThumbUrl=t.thumbUrl),e.mediaUrl=t.url,void 0!=t.sizes&&(e.mediaAspectFull=t.sizes.full,e.mediaAspect16x9=t.sizes["16:9"],e.mediaAspect1x1=t.sizes["1:1"],e.mediaAspect2x1=t.sizes["2:1"]),void 0!=e.mediaAspect16x9?(e.mediaAspectRatio=1.778,e.mediaAspectFeed=e.mediaAspect16x9,e.mediaAspect16x9.w<e.mediaAspect16x9.h?e.mediaOrientation="portrait":e.mediaOrientation="landscape"):void 0!=e.mediaAspect1x1?(e.mediaAspectRatio=1,e.mediaAspectFeed=e.mediaAspect1x1,e.mediaOrientation="square"):void 0!=e.mediaAspect2x1&&(e.mediaAspectRatio=2,e.mediaAspectFeed=e.mediaAspect2x1,e.mediaAspect2x1.w<e.mediaAspect2x1.h?e.mediaOrientation="portrait":e.mediaOrientation="landscape"),void 0!=e.mediaAspectFeed&&(void 0==e.mediaAspectFeed.x?0:e.mediaAspectFeed.x,void 0==e.mediaAspectFeed.y?0:e.mediaAspectFeed.y,void 0==e.mediaAspectFeed.w?0:e.mediaAspectFeed.w,void 0==e.mediaAspectFeed.h?0:e.mediaAspectFeed.h),void 0!=e.mediaAspectFull&&(void 0==e.mediaAspectFull.x?0:e.mediaAspectFull.x,void 0==e.mediaAspectFull.y?0:e.mediaAspectFull.y,void 0==e.mediaAspectFull.w?0:e.mediaAspectFull.w,void 0==e.mediaAspectFull.h?0:e.mediaAspectFull.h),e}function o(o,n){return o.embedType=n.type,o.embedTitle=n.title,o.embedText=n.text,o.embedMedia={},"media"!==n.type&&"link"!==n.type||n.media&&(o.embedMedia=t(o.embedMedia,n.media[0])),o.embedUrl=n.url,o.embedPlayable=n.playable,o.embedHtml=n.html,o.embedMetrics=n.metrics,o.embedMini=n.mini,o.embedAuthor=n.author,o.embedProvider=n.provider,o.embedCreatedAt=e.getTimeSince(n.createdAt),o.embedCreatedAtFull=n.createdAt,o}function n(n){var i={};if(i.id=n.id,i.author=n.author,i.owner=n.owner,void 0!=n.content.sections)for(i.sectionsLength=n.content.sections.length,j=0;j<i.sectionsLength;j++)i.type=n.content.sections[j].type,"html"==i.type&&(i.html=n.content.sections[j].html),"media"==i.type&&(i.media=n.content.sections[j].media,i=t(i,i.media[0])),"embed"!=i.type&&"tweet"!=i.type||null!==n.content.sections[j].embed&&(i=o(i,n.content.sections[j].embed),i.embed=n.content.sections[j].embed),i.tweet=n.content.sections[j].tweet,i.ogp=n.content.sections[j].ogp,i.link=n.content.sections[j].link;if(i.signal=n.signal,void 0==i.signal){var r={like:!1};i.signal=r}else void 0==i.signal.like&&(i.signal.like=!1);return i.metrics=n.metrics,i.createdAtFull=n.createdAt,i.createdAt=e.getTimeSince(n.createdAt),i.pin=n.pin,i.commentId=n.commentId,i.topicId=n.topicId,i}function i(e,t){return e.signal.like==t?(NETWORK_DEBUG&&console.log("no need to change   data.signal.like:"+e.signal.like),e):(t?(e.signal.like=!0,void 0==e.metrics.likes?e.metrics.likes=1:e.metrics.likes=e.metrics.likes+1):(e.signal.like=!1,void 0!=e.metrics.likes&&(e.metrics.likes=e.metrics.likes-1)),NETWORK_DEBUG&&console.log("data.metrics.likes :"+e.metrics.likes),e)}var r=5;return{bant:n,updateBantLiked:i}}]),angular.module("NetworkModule").factory("UserInfoService",["ForumStorage","URIHelper",function(e,t){function o(){return void 0==a?(NETWORK_DEBUG&&console.log("UserInfoService : UserId is not defined , using static user, TODO : Remove this for release build"),a=s,s):a}function n(e){return e==a.userId}function i(t,o,n,i){NETWORK_DEBUG&&console.log("setUserCredentials: ",t,o,n,i),a.userId=t,a.accessToken=o,a.sessionId=n,c=!0,a.userType=i,e.setToLocalStorage("forumIsLoggedIn",c),e.setToLocalStorage("forumUserId",t),e.setToLocalStorage("forumAccessToken",o),e.setToLocalStorage("forumSessionId",n),e.setToLocalStorage("forumUserType",i)}function r(){return!!e.getFromLocalStorage("hasUserVisited")}var a={},s={userId:"193",accessToken:"dsKGKXyZgGs=",sessionId:"53d7b518"},c=!1;return{getUserCredentials:o,setUserCredentials:i,isCurrentUser:n,hasUserVisited:r,isUserLoggedIn:function(){return c?!0:e.getFromLocalStorage("forumIsLoggedIn")?(a={},a.userId=e.getFromLocalStorage("forumUserId"),a.accessToken=e.getFromLocalStorage("forumAccessToken"),a.sessionId=e.getFromLocalStorage("forumSessionId"),!0):!1},isPeelUser:function(){var o=t.isPeelUser();return NETWORK_DEBUG&&console.log("ForumStorage.getFromLocalStorage: "+e.getFromLocalStorage("forumUserType")),o?!0:"peel"===a.userType?!0:"peel"===e.getFromLocalStorage("forumUserType")},isSmartStadiumUser:function(){var o=t.isSmartStadiumUser();return NETWORK_DEBUG&&console.log("ForumStorage.getFromLocalStorage: ",e.getFromLocalStorage("forumUserType")),o?(a.userType="email",!0):"email"===a.userType?!0:"email"===e.getFromLocalStorage("forumUserType")},isMI16User:function(){var o=t.isTechMUser();return NETWORK_DEBUG&&console.log("ForumStorage.getFromLocalStorage: ",e.getFromLocalStorage("forumUserType")),o?(a.userType="MI16",!0):"MI16"===a.userType?!0:"MI16"===e.getFromLocalStorage("forumUserType")},isMWCUser:function(){var o=t.isMWCUser();return NETWORK_DEBUG&&console.log("ForumStorage.getFromLocalStorage: ",e.getFromLocalStorage("forumUserType")),o?(a.userType="MWC",!0):"MWC"===a.userType?!0:"MWC"===e.getFromLocalStorage("forumUserType")},getUserType:function(){return GEN_DEBUG&&console.log("Get User Type: ",a.userType),a.userType},isGuestUser:function(){return GEN_DEBUG&&console.log("Guest User?"),"guest"===a.userType||"guest"===e.getFromLocalStorage("forumUserType")}}}]),angular.module("AuthModule").factory("AuthService",["$http","$window","$location","$routeParams","UserInfoService","TopicService","ReplyService","networkService","ForumDeviceInfo","ChannelService","URIHelper",function(e,t,o,n,i,r,a,s,c,l,d){var u=!1,m=function(e){NETWORK_DEBUG&&console.log("Logging in as Guest");var t={};t.id=c.getDeviceId(),t.userName="GuestUser";var o=h("guest",-28800,t);T(o,null,e)},p=function(e){FB.login(function(t){if("connected"===t.status){e();var o=h("facebook",-25200,t.authResponse);T(o)}})},g=function(e){E(e)},f=function(e){var t={id:d.getSSUserId(),userName:d.getSSUserName()},o=h("email",-28800,t);T(o,null,e)},v=function(e,t,o){var n={id:t,userName:e};NETWORK_DEBUG&&console.log("techMLogin: ",n);var i=h("email",-28800,n);T(i,o)},h=function(e,t,o){var n=c.getDeviceId(),i={type:e,locale:"en_US",utcOffset:t,deviceType:"web",deviceId:n,deviceModel:"browser",appKey:"testKey",appVersion:"1.0"};return"facebook"===e?i.facebook={id:o.userID,accessToken:o.accessToken}:"peel"===e?i.peel={id:o.id,name:o.userName}:"email"===e&&(i.email={id:o.id,name:o.userName}),i},T=function(t,o,n){console.log("REGISTER");var r=t.type;o&&(r=o),e.post(REGISTER_SERVER_URI,JSON.stringify(t)).then(function(e){200===e.status&&(NETWORK_DEBUG&&console.log("Successfully Registered User of Type: "+r),"facebook"===t.type&&(u=!0),i.setUserCredentials(e.data.userId,e.data.accessToken,e.data.sessionId,r))},function(e){NETWORK_DEBUG&&console.log("Registration Error: ",e)}).then(function(e){console.log("Registration response: "),E(n)})},E=function(e){NETWORK_DEBUG&&console.log("Initializing Content"),s.init();var t=l.getChannel(),i=r.getTopicId()||n.topicID;if(t)NETWORK_DEBUG&&console.log("found channel ID: "+t),s.send(l.getLiveGameTopic(t));else if(i){if(-1!==window.location.href.indexOf("?")){var c=window.location.href.slice(window.location.href.indexOf("?")+1);console.log("Auth UrlQueryStr: ",c)}NETWORK_DEBUG&&console.log("found Topic ID: "+i),e?e():c?o.url("/topic/"+i+"?"+c):o.url("/topic/"+i)}else{var d=a.getPostId();d&&(NETWORK_DEBUG&&console.log("found post ID: "+d),o.url("/post/"+d))}};return{loginAsGuest:m,loginToFacebook:p,loginWithPeel:g,loginWithEmail:f,techMLogin:v,setRegistrationParams:h,registerUser:T,initializeContent:E,userLoggedInToFacebook:u}}]),angular.module("NetworkModule").service("StaticData",function(){function e(){for(var e=[],t=["fakePhoto1.jpg","fakePhoto2.jpg","fakePhoto3.jpg","fakePhoto4.jpg","fakePhoto5.jpg","fakePhoto6.jpg"],i=0,r=["fakeVideo1.jpg","fakeVideo2.jpg","fakeVideo3.jpg"],a=0,s=[{type:"photo",postContent:"Will this be the year Kaep teaches Sherman a lesson or will Kaep get schooled again?",postMedia:"fakePhoto1.jpg"},{type:"video",postContent:"Remember Kyle Williams - for some reason, I am having recurring nightmares about him again - weird but true:(",postMedia:"fakeVideo1.jpg"},{type:"photo",postContent:"Will Kaep be given a free reign to do whatever he wants? Please don't make him a pocket passer because HE IS NOT ONE",postMedia:"fakePhoto2.jpg"},{type:"video",postContent:"Running back of the 9ers this season truly scares the hell out of me - thoughts?",postMedia:"fakeVideo2.jpg"},{type:"video",postContent:"Will our defense save us again? We have seen that this offense needs lot of help:(",postMedia:"fakeVideo3.jpg"},{type:"photo",postContent:"Can't wait for this game - gets me want to kick Seahawks every time we play them",postMedia:"fakePhoto3.jpg"},{type:"text",postContent:"Jimmy Graham is going to be such a formidable match-up for our secondary. Not sure if we have the personnel to cover him. Hate the fact that the saehawks offense just got whole lot better this year",postMedia:""},{type:"text",postContent:"From contenders to last in the league - reasons for our free fall down the ranks",postMedia:""},{type:"text",postContent:"One more drubbing - when are we going to be good again?",postMedia:""},{type:"text",postContent:"How do we always fuck up the second half? It is always the take of two halves with us this year. Sucks",postMedia:""},{type:"text",postContent:"Are you fuckin kidding me - how did we miss that tackle? Why do we keep messing up defensively during 3rd and long? That is the 5th 3rd and long conversion for the Hawks.. Come on DDDDD",postMedia:""},{type:"text",postContent:"Time to talk about the next season already? Sure nothing is going to change and we are going to suck again.. ",postMedia:""},{type:"text",postContent:"We miss Aldon Smith so much - we absolutely don't have an edge rusher.. what a jack-ass.. blew away so much second chances:(",postMedia:""}],c=0;c<s.length;c++){var l=s[c],d=new Object;d.postID=c;var u=20,m=u+Math.round(Math.random()*(n.length-u));n.substring(0,m);d.postContent=l.postContent;var p=l.type;if(d.postType=p,"photo"==p){var g=t[i%t.length];d.photo=g,i++}else if("video"==p){var f=r[a%r.length];d.video=f,a++}var v=o[c%o.length];d.postAuthorPhoto=v.photo,l.postAuthorPhoto=v.photo,d.postAuthorName=v.name,l.postAuthorName=v.name,d.likeCount=Math.floor(100*Math.random()),l.likeCount=Math.floor(100*Math.random()),d.commentCount=Math.floor(500*Math.random()),l.commentCount=Math.floor(500*Math.random()),e.push(l)}return e}function t(){for(var e=[],t=0;10>t;t++){var i=new Object;i.postID=t;var r=20,a=r+Math.round(Math.random()*(n.length-r)),s=n.substring(0,a);i.replyContent=s,i.replyType="text";var c=o[t%o.length];i.postAuthorPhoto=c.photo,i.postAuthorName=c.name,i.likeCount=Math.floor(100*Math.random()),i.commentCount=Math.floor(500*Math.random()),e.push(i)}return e}var o=[{photo:"ana.png",name:"Ana"},{photo:"arod.png",name:"A-Rod"},{photo:"cristiano.png",name:"Cristiano"},{photo:"derek.png",name:"Derek"},{photo:"dwayne.png",name:"Dwayne"},{photo:"erin.png",name:"Erin"},{photo:"jordan.png",name:"Michael"},{photo:"lebron.png",name:"Lebron"},{photo:"lionel.png",name:"Lionel"},{photo:"maria.png",name:"Maria"}],n="Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris";return{getPostsForTopicID:e,getRepliesForPostID:t}}),angular.module("NetworkModule").factory("FDSUtility",function(){function e(e,t){for(NETWORK_DEBUG&&console.log("structureLengths :"+e.length),i=0;i<e.length;i++)if(e[i].id==t)return e[i]}function t(e,t){for(NETWORK_DEBUG&&console.log("structureLengths :"+e.length),i=0;i<e.length;i++)if(e[i].id==t)return i;return-1}function o(t,o){var n=e(t,o);return void 0!=n&&(NETWORK_DEBUG&&console.log("found element :"+n+" tempStructure.signal.like :"+n.signal.like),1==n.signal.like)}function n(t,o){var n=e(t,o);return void 0!=n&&(NETWORK_DEBUG&&console.log("found element :"+n+" tempStructure.signal.flag :"+n.signal.flag),1==n.signal.flag)}function r(t,o,n){var i=e(t,o);void 0!=i&&(NETWORK_DEBUG&&console.log("found element :"+i+" tempStructure.signal.flag :"+i.signal.flag),i.signal.flag=n)}function a(e,o){var n=t(e,o);return-1!=n&&(NETWORK_DEBUG&&console.log("found element at:"+n),e.splice(n,1)),e}return{isLikedById:o,isFlaggedById:n,flagById:r,deleteById:a}}),angular.module("MediaModule",["angularFileUpload","NetworkModule","TopicModule"]).factory("MUService",function(){function e(){var e={rid:"comment",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(n)};return e.data={lang:"en",topicId:s},r||(e={rid:"reply",timestamp:(new Date).getTime(),method:"POST",uri:encodeURI(i)},e.data={lang:"en",topicId:s},e.data.target={type:"comment",id:c},e.data.commentId=c),e}function t(e,t,o,n,i){void 0===t&&(t=""),NETWORK_DEBUG&&console.log("Setting Comment Params: ",e,t,o,n,i),s=e,a=t,r=o,c=n,l=i}function o(t){var o={media:[t]},n=[];void 0!==a&&n.push({type:"html",html:a}),n.push({type:"media",media:o.media});var i=e(),r={sections:n};return i.data.content=r,NETWORK_DEBUG&&console.log("Media comment Request :"+JSON.stringify(i,null,10)),i}var n="/v1.0/comment/create",i="/v1.0/reply/create",r=!0,a="",s="",c="",l="";
return{postMediaRequest:o,setCommentParams:t,resetCommentParams:function(){s="",c="",a=""}}}),angular.module("ChannelModule").factory("AnalyticsService",["$interval","$http","UserInfoService","UserAgentService","$routeParams",function(e,t,o,n,i){function r(){var e=C,t=l();e.sessionStack=t;var o={context:{"class":"user-engagement",category:"discussion",data:e}},n={};return angular.copy(o,n),n}function a(){return k+=1}function s(e){var t={};t.id=e+"_"+a();var o=new Date;return t.timeStamp=o.getTime(),ANALYTICS_DEBUG&&(console.log("Analytics ****** getSession Object"),console.log(t)),t}function c(){if(null!=G&&G.length>0){var e=G[G.length-1];return e.timeStamp}return null}function l(){for(var e=[],t=0;t<G.length;t++)ANALYTICS_DEBUG&&console.log("Analytics ****** "+G[t].id),e.push(G[t].id);return console.log(e),e}function d(e){var t=s(e);G.push(t),ANALYTICS_DEBUG&&console.log("Analytics ****** : sessionStackInterNAl length : "+G.length)}function u(){}function m(){}function p(){console.log("****************** send event to server triggered"),D.length>0&&(t.post(ANALYTICS_SERVER,JSON.stringify(D)).then(function(e){200===e.status&&(ANALYTICS_DEBUG&&console.log("Successfully Sent analytics events to server"),D=[])},function(e){ANALYTICS_DEBUG&&console.log("Analytics Error: ",e)}).then(function(e){ANALYTICS_DEBUG&&console.log("Analytics Resp: ",e)}),b(),D=[])}function g(t,o){if(!A){d("start"),f();var i=r();i.createdAt=new Date,i.context.type="join";var a={channelId:t,topicId:o};i.content=a,D.push(i),A=!0,ANALYTICS_DEBUG&&(console.log("Analytics ****** joinSessionEvent"),console.log(n.getDeviceInfo())),y=e(p,6e4)}}function f(){var e=r();e.createdAt=new Date,e.context.type="engage",e.context.category="access";var t={environment:n.getDeviceInfo()};e.content=t,D.push(e)}function v(){var e=r();e.createdAt=new Date,e.context.type="disengage",e.context.category="access";var t={environment:n.getDeviceInfo()};e.content=t,D.push(e)}function h(t,o){var n=r(),i=new Date;for(n.createdAt=i,n.context.type="leave";G.length>1;)G.pop();var a=i.getTime()-c(),s={channelId:t,topicId:o,duration:a};n.content=s,D.push(n),v(),b(),e.cancel(y),p(),A=!1,G=[]}function T(e){for(var t=new Date;G.length>2;)G.pop();var o=t.getTime()-c(),n=r();n.createdAt=new Date,n.context.type="browse";var i="topic-view."+e+"-section",a={entity:i,duration:o};n.content=a,D.push(n),G.pop(),ANALYTICS_DEBUG&&console.log("Analytics ****** browseEvent triggered")}function E(e,t,o,n,i,a,s){var l=new Date,d=l.getTime()-c();void 0!=s&&(d=1e3*s);var u=r();u.createdAt=new Date,u.context.type="explore";var m={entity:e,entityId:t,provider:o,providerId:n,source:i,site:a,duration:d};u.content=m,D.push(u),G.pop(),ANALYTICS_DEBUG&&console.log("Analytics ****** exploreSessionEvent triggered")}function S(e,t,o,n,i,a){var s=(new Date,r());s.createdAt=new Date,s.context.type="explore";var c={entity:e,entityId:t,provider:o,providerId:n,source:i,site:a};s.content=c,D.push(s),ANALYTICS_DEBUG&&console.log("Analytics ****** exploreEvent triggered")}function U(e,t,o,n,i,a){var s=(new Date,r());s.createdAt=new Date,s.context.type="express";var c={entity:"social-post",entityId:t,provider:o,providerId:n,source:i,action:"twitter-"+e,site:"topic-view."+a+"-section.social-post"};s.content=c,D.push(s),ANALYTICS_DEBUG&&console.log("Analytics ****** exploreEvent triggered")}function w(e,t,o){console.log("setting login session ID",e,t,o),C.userId=t,C.sessionId=o,C.engagementId=e,I=!0,ANALYTICS_DEBUG&&console.log("Analytics ****** Base Event :"),console.log(C),g(i.channelID,i.topicID)}function b(){ANALYTICS_DEBUG&&console.log(D)}var y,C={},A=!1,I=!1,D=[],G=[],k=0;return{sendEventsToServer:p,joinSessionEvent:g,leaveSessionEvent:h,browseSessionEvent:T,exploreSessionEvent:E,exploreEvent:S,expressSocialEvent:U,addEvent:m,addSessionEvent:u,addSession:d,setLoginSessionId:w,printEventStack:b,isInitialized:function(){return I}}}]);
//# sourceMappingURL=app.min.js.map
